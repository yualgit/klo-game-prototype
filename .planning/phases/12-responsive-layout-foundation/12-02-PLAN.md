---
phase: 12-responsive-layout-foundation
plan: 02
type: execute
wave: 2
depends_on: ["12-01"]
files_modified:
  - src/scenes/LevelSelect.ts
  - src/scenes/Menu.ts
  - index.html
autonomous: false

must_haves:
  truths:
    - "Level Select scene shows complete road, checkpoints, and CTA buttons on iPhone SE (375x667)"
    - "Level Select HUD text (lives, bonuses, countdown) is readable on all devices"
    - "Menu title, subtitle, and Play button are properly sized on narrow viewports"
    - "Game renders into safe area on iPhone X+ (no content hidden behind notch/home bar)"
    - "All scenes scale smoothly on browser resize and device rotation"
  artifacts:
    - path: "src/scenes/LevelSelect.ts"
      provides: "Responsive LevelSelect with DPR-aware UI sizing and viewport-adapted layout"
    - path: "src/scenes/Menu.ts"
      provides: "Responsive Menu with DPR-aware text and button sizing"
    - path: "index.html"
      provides: "viewport-fit=cover and CSS safe-area-inset padding"
  key_links:
    - from: "src/scenes/LevelSelect.ts"
      to: "src/utils/responsive.ts"
      via: "import getResponsiveLayout, cssToGame"
      pattern: "import.*responsive"
    - from: "src/scenes/Menu.ts"
      to: "src/utils/responsive.ts"
      via: "import cssToGame"
      pattern: "import.*responsive"
    - from: "index.html"
      to: "CSS env(safe-area-inset-*)"
      via: "viewport-fit=cover meta tag and CSS padding"
      pattern: "viewport-fit=cover"
---

<objective>
Make LevelSelect and Menu scenes responsive, add iOS safe area support, and verify on all target viewports.

Purpose: After Plan 01 makes the Game scene responsive, the remaining scenes (LevelSelect, Menu) still use hardcoded pixel values for fonts, buttons, and HUD elements. LevelSelect has a 1024px-wide map world that needs viewport-aware camera handling. iOS devices with notches need safe area insets to prevent content from being obscured.

Output: Fully responsive LevelSelect + Menu scenes, iOS safe area CSS support, verified across target viewports.
</objective>

<execution_context>
@/Users/vasiliyhrebenuyk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vasiliyhrebenuyk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-responsive-layout-foundation/12-01-SUMMARY.md
@src/scenes/LevelSelect.ts
@src/scenes/Menu.ts
@src/utils/responsive.ts
@src/game/constants.ts
@index.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Make LevelSelect and Menu scenes responsive with safe area support</name>
  <files>
    src/scenes/LevelSelect.ts
    src/scenes/Menu.ts
    index.html
  </files>
  <action>
**Part A: Update `index.html` for iOS safe area support**

1. Add `viewport-fit=cover` to existing viewport meta tag:
   ```html
   <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
   ```

2. Add CSS safe area padding to `#game-container`:
   ```css
   #game-container {
     width: 100vw;
     height: 100vh;
     /* Shrink container to avoid notch/home bar — Phaser canvas fills this */
     padding-top: env(safe-area-inset-top);
     padding-bottom: env(safe-area-inset-bottom);
     padding-left: env(safe-area-inset-left);
     padding-right: env(safe-area-inset-right);
     display: flex;
     justify-content: center;
     align-items: center;
   }
   ```

   Note: With `viewport-fit=cover`, the page extends into unsafe areas. The padding on the container pushes the game canvas inside the safe area, so Phaser never renders behind the notch.

**Part B: Update `src/scenes/LevelSelect.ts`** for responsive layout

1. Import `getResponsiveLayout, cssToGame, getDpr` from `'../utils/responsive'`

2. Store layout on create: `this.layout = getResponsiveLayout(width, height)`

3. **HUD Background**: Use `this.layout.hudHeight + cssToGame(20)` for the white HUD bar at top (120px was hardcoded, should be responsive). Minimum of `cssToGame(100)`.

4. **Title text**: Font size `${cssToGame(32)}px` instead of `'40px'`. Position at `(width / 2, this.hudBarHeight / 2)`.

5. **Economy HUD** (`createEconomyHUD`):
   - Heart icon font: `${cssToGame(20)}px`
   - Lives text font: `${cssToGame(20)}px`
   - Countdown text font: `${cssToGame(14)}px`
   - Bonus icon font: `${cssToGame(16)}px`
   - Bonus text font: `${cssToGame(16)}px`
   - Position relative to `width - cssToGame(80)` (not hardcoded `width - 100`)
   - Vertical spacing proportional

6. **Back button** (`createBackButton`):
   - Button dimensions: `cssToGame(80)` x `cssToGame(36)`
   - Font size: `${cssToGame(14)}px`
   - Position: `(cssToGame(55), cssToGame(24))`

7. **Settings button** (`createSettingsButton`):
   - Font size: `${cssToGame(24)}px` (was 28px)
   - Position: `(width - cssToGame(160), cssToGame(24))`

8. **Level checkpoint buttons** (`createLevelCheckpoint`):
   - Checkpoint circle size: `cssToGame(55)` (was 70)
   - Level number font: `${cssToGame(26)}px` (was 32px)
   - Stars font: `${cssToGame(14)}px` (was 18px)
   - Landmark text font: `${cssToGame(11)}px` (was 14px)
   - Crown display size: `cssToGame(22)` (was 28)
   - Lock icon size: `cssToGame(26)` (was 32)
   - Container size: same as checkpoint circle

9. **Map pointer** (`createMapPointer`):
   - Display size: `cssToGame(32)` (was 40)

10. **Overlay panels** (`showNoLivesPrompt`, `showSettingsOverlay`):
    - Panel width: `Math.min(cssToGame(300), width * 0.9)` (cap to viewport)
    - Panel height: scale proportionally
    - All text fonts: use cssToGame() for sizing
    - Button dimensions: use layout values
    - Reposition all internal elements relative to panel dimensions

11. **Overlay button** (`createOverlayButton`):
    - Button dimensions: `cssToGame(170)` x `cssToGame(44)`
    - Font size: `${cssToGame(16)}px`

12. **Camera bounds**: Keep world at MAP_CONFIG.MAP_WIDTH (1024) x MAP_CONFIG.MAP_HEIGHT (2200). The camera viewport is smaller, which naturally provides a zoom-out or scrollable view. On narrow viewports (~750px game width), the map is wider than the viewport, meaning horizontal content near edges may be partially offscreen. However, level nodes span x=260..650 which is a 390px range — this fits within even a 720px viewport, so no horizontal scrolling needed. Set camera's scrollX to center the node range: `camera.scrollX = (MAP_CONFIG.MAP_WIDTH - width) / 2` clipped to bounds. This ensures the winding road is centered.

13. **handleResize()**: Recompute layout, reposition all HUD elements, update camera center offset.

14. **repositionEconomyHUD()**: Use cssToGame() for all position calculations.

**Part C: Update `src/scenes/Menu.ts`** for responsive layout

1. Import `cssToGame` from `'../utils/responsive'`

2. **Title text**:
   - Font size: `${cssToGame(48)}px` instead of `'64px'`
   - Position: `(width / 2, height / 3)` (already proportional)

3. **Subtitle text**:
   - Font size: `${cssToGame(18)}px` instead of `'24px'`
   - Position offset: `height / 3 + cssToGame(45)` instead of `+ 60`

4. **Play button** (`createPlayButton`):
   - Button width: `cssToGame(160)` (was 200)
   - Button height: `cssToGame(50)` (was 60)
   - Font size: `${cssToGame(22)}px` (was 28px)

5. **Floating tiles**:
   - Display size: `cssToGame(36)` x `cssToGame(36)` (was 48x48)
   - Y oscillation amplitude: `cssToGame(10)` (was 15)

6. **handleResize()**: Already proportional for positioning (uses percentages). Just update floating tile display sizes.
  </action>
  <verify>
Run `npx tsc --noEmit` — TypeScript compiles with no errors.
Run `npx vite build` — Vite builds successfully.
Verify index.html contains `viewport-fit=cover`.
Verify index.html has `env(safe-area-inset-*)` CSS.
Verify LevelSelect.ts imports from responsive.ts.
Verify Menu.ts imports from responsive.ts.
  </verify>
  <done>
LevelSelect scene uses DPR-aware responsive sizing for HUD, level nodes, overlays. Menu uses DPR-aware font and button sizes. iOS safe area support via viewport-fit=cover + CSS env() padding. All text readable at minimum 14px CSS equivalent on all devices.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify responsive layout on target devices</name>
  <files>none — visual verification only</files>
  <action>
Human verifies responsive layout across all target viewports. Claude starts dev server if not already running.

What was built: Responsive layout system across all scenes — DPR-aware text sizing, viewport-constrained overlays, adaptive grid, iOS safe area support.

How to verify:
1. Run `npx vite dev` to start dev server
2. Open in Chrome DevTools with device emulation:
   a. **iPhone SE (375x667)**: Menu title and Play button visible, readable text. Level Select road path visible, all level nodes accessible by scrolling, HUD text readable. Game grid centered, all 8 columns visible, HUD text readable, no overlap with grid.
   b. **iPhone 14 Pro (393x852)**: Same checks plus verify notch area not obstructing content.
   c. **Android (360x740)**: Same checks, verify grid fits.
   d. **Desktop (1920x1080)**: Everything still works, no excessive scaling.
3. Try resizing browser window — layout adapts smoothly without breaks.
4. In Game scene, complete or lose a level — verify overlay panels fit and buttons are tappable.
5. In LevelSelect, open Settings overlay — verify it fits on narrow viewport.
  </action>
  <verify>All five viewport checks pass without layout breaks, text cropping, or inaccessible elements.</verify>
  <done>User confirms "approved" — responsive layout works across iPhone SE, iPhone 14 Pro, Android 360x740, and desktop. Resume signal: type "approved" or describe specific issues.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. `npx vite build` succeeds
3. All scenes import from responsive.ts
4. index.html has viewport-fit=cover and safe area CSS
5. No hardcoded pixel font sizes remain in scene files (all use cssToGame)
6. Level Select road and checkpoints visible on 375px viewport
7. Game grid fits within viewport on all target devices
</verification>

<success_criteria>
- Level Select scene shows complete road, checkpoints, and CTA buttons on iPhone SE (375x667)
- Game Board fully visible with all edge cells accessible on Android 360x740 screens
- HUD elements never overlap grid or crop level goals on any test device
- Game scales smoothly when device rotated or browser resized (no layout breaks)
- iOS safe area padding prevents content from rendering behind notch
</success_criteria>

<output>
After completion, create `.planning/phases/12-responsive-layout-foundation/12-02-SUMMARY.md`
</output>
