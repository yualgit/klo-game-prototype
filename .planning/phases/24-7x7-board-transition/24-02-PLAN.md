---
phase: 24-7x7-board-transition
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - public/data/levels/level_001.json
  - public/data/levels/level_002.json
  - public/data/levels/level_003.json
  - public/data/levels/level_004.json
  - public/data/levels/level_005.json
  - public/data/levels/level_006.json
  - public/data/levels/level_007.json
  - public/data/levels/level_008.json
  - public/data/levels/level_009.json
  - public/data/levels/level_010.json
autonomous: true

must_haves:
  truths:
    - "All 10 levels specify 7x7 grid dimensions"
    - "Levels with cell_maps have 7x7 cell_map arrays"
    - "All obstacle and pre-placed tile positions fit within 0-6 row/col range"
    - "Goal counts and move counts are adjusted for smaller board (fewer total cells)"
    - "Each level remains winnable with adjusted parameters"
  artifacts:
    - path: "public/data/levels/level_001.json"
      provides: "L1 tutorial level at 7x7"
      contains: "\"width\": 7"
    - path: "public/data/levels/level_006.json"
      provides: "L6 diamond shape at 7x7 with cell_map"
      contains: "\"width\": 7"
    - path: "public/data/levels/level_010.json"
      provides: "L10 final challenge at 7x7 with cell_map"
      contains: "\"width\": 7"
  key_links:
    - from: "public/data/levels/*.json"
      to: "src/scenes/Game.ts"
      via: "levelData.grid.width/height"
      pattern: "\"width\": 7.*\"height\": 7"
---

<objective>
Retrofit all 10 existing levels (L1-L10) from 8x8 to 7x7 boards with adjusted goals, moves, obstacle positions, and cell_maps.

Purpose: Complete the board size transition. Levels must be playable and balanced for the smaller 7x7 grid which has ~24% fewer cells (49 vs 64 for full boards). Goals and moves are scaled down proportionally to maintain similar difficulty.

Output: All 10 level JSON files updated with 7x7 dimensions, redesigned cell_maps, repositioned obstacles/pre-placed tiles, and balanced goals/moves.
</objective>

<execution_context>
@/Users/vasiliyhrebenuyk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vasiliyhrebenuyk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@public/data/levels/level_001.json
@public/data/levels/level_002.json
@public/data/levels/level_003.json
@public/data/levels/level_004.json
@public/data/levels/level_005.json
@public/data/levels/level_006.json
@public/data/levels/level_007.json
@public/data/levels/level_008.json
@public/data/levels/level_009.json
@public/data/levels/level_010.json

@src/game/types.ts (LevelData interface -- grid.width, grid.height, cell_map, obstacles, pre_placed_tiles)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Retrofit L1-L5 (simple boards without cell_map) to 7x7</name>
  <files>public/data/levels/level_001.json, public/data/levels/level_002.json, public/data/levels/level_003.json, public/data/levels/level_004.json, public/data/levels/level_005.json</files>
  <action>
Update each level's grid dimensions and rebalance. The key principle: 7x7 has 49 cells vs 64 (8x8), which is ~76% of the original area. Scale goals to roughly 75-80% of original, reduce moves by 1-2 where appropriate.

**Level 1** (currently 6x8 = 48 cells, tutorial):
- Change grid to `"width": 7, "height": 7` (49 cells, actually slightly larger than original 6x8)
- Goals: Keep `"count": 20` burger collection (was 20 on 48 cells, 49 cells is similar)
- Moves: Keep at 15 (tutorial level, should be generous)

**Level 2** (currently 8x8, dual collect):
- Change grid to `"width": 7, "height": 7`
- Goals: Reduce both from 15 to 12 (was 15 each on 64 cells, scaled to ~12 on 49 cells)
- Moves: Reduce from 15 to 13

**Level 3** (currently 8x8, single collect + ice obstacles):
- Change grid to `"width": 7, "height": 7`
- Goals: Reduce burger count from 20 to 15
- Moves: Keep at 14 (already tight)
- Obstacles: Ice positions [3,3], [4,3], [3,4] -- all within 0-6 range, keep as-is

**Level 4** (currently 8x8, collect + destroy ice):
- Change grid to `"width": 7, "height": 7`
- Goals: Reduce hotdog count from 15 to 12. Keep ice destroy at 5 (same number of obstacles).
- Moves: Keep at 14
- Obstacles: Ice positions [2,2], [5,2], [3,4], [4,4], [3,5] -- all within 0-6 range, keep as-is

**Level 5** (currently 8x8, collect + grass obstacles):
- Change grid to `"width": 7, "height": 7`
- Goals: Reduce snack count from 20 to 15
- Moves: Reduce from 15 to 13
- Obstacles: Grass positions [3,3], [4,3], [3,4] -- all within 0-6 range, keep as-is

For each file, ensure:
1. `"width": 7, "height": 7` in the grid object
2. No `blocked_cells` entries reference row/col >= 7 (currently all are `[]`, so fine)
3. All obstacle positions are in 0-6 range
4. Spawn rules are unchanged (they are weight-based, not position-dependent)
  </action>
  <verify>
For each file, run: `python3 -c "import json; d=json.load(open('FILE')); g=d['grid']; assert g['width']==7 and g['height']==7, f'Bad grid: {g}'; obs=[p for o in d.get('obstacles',[]) for p in o['positions'] if p[0]>=7 or p[1]>=7]; assert not obs, f'OOB obstacles: {obs}'; print('OK:', FILE)"`
  </verify>
  <done>Levels 1-5 all have 7x7 grids, balanced goals/moves, and valid obstacle positions within 0-6 range.</done>
</task>

<task type="auto">
  <name>Task 2: Retrofit L6-L10 (shaped boards with cell_map) to 7x7</name>
  <files>public/data/levels/level_006.json, public/data/levels/level_007.json, public/data/levels/level_008.json, public/data/levels/level_009.json, public/data/levels/level_010.json</files>
  <action>
These levels have cell_map arrays defining non-rectangular board shapes. Each cell_map must be redesigned as 7x7 while preserving the visual feel of the original shape.

**Level 6** (diamond shape, currently 8x8 with 24 active cells):
- New 7x7 cell_map (diamond shape, ~20-22 active cells):
```json
[
  [0, 0, 0, 1, 0, 0, 0],
  [0, 0, 1, 1, 1, 0, 0],
  [0, 1, 1, 1, 1, 1, 0],
  [1, 1, 1, 1, 1, 1, 1],
  [0, 1, 1, 1, 1, 1, 0],
  [0, 0, 1, 1, 1, 0, 0],
  [0, 0, 0, 1, 0, 0, 0]
]
```
Active cells: 25 (similar to original 24)
- Goals: Reduce burger count from 25 to 20. Keep ice destroy at 9 (same obstacle count).
- Moves: Reduce from 20 to 18
- Obstacles: Ice positions need adjustment to fit in active cells. Original [3,3],[3,4],[4,3]. In new 7x7 diamond, center is [3,3]. Use positions [[3,2],[3,3],[3,4]] (all active in center row).

**Level 7** (hourglass/bowtie shape, currently 8x8 with 32 active cells):
- New 7x7 cell_map (hourglass shape, ~25-28 active cells):
```json
[
  [1, 1, 1, 1, 1, 1, 1],
  [0, 1, 1, 1, 1, 1, 0],
  [0, 0, 1, 1, 1, 0, 0],
  [0, 0, 0, 1, 0, 0, 0],
  [0, 0, 1, 1, 1, 0, 0],
  [0, 1, 1, 1, 1, 1, 0],
  [1, 1, 1, 1, 1, 1, 1]
]
```
Active cells: 25
- Goals: Reduce grass destroy from 12 to 9, hotdog collect from 15 to 12.
- Moves: Reduce from 22 to 18
- Obstacles: Original grass at [0,3],[0,4],[7,3],[7,4]. New positions for 7x7: [[0,2],[0,3],[6,3],[6,4]] (top and bottom rows, which are fully active).

**Level 8** (plus/cross shape, currently 8x8 with 40 active cells):
- New 7x7 cell_map (cross shape, ~33 active cells):
```json
[
  [0, 0, 1, 1, 1, 0, 0],
  [0, 0, 1, 1, 1, 0, 0],
  [1, 1, 1, 1, 1, 1, 1],
  [1, 1, 1, 1, 1, 1, 1],
  [1, 1, 1, 1, 1, 1, 1],
  [0, 0, 1, 1, 1, 0, 0],
  [0, 0, 1, 1, 1, 0, 0]
]
```
Active cells: 33 (down from 40)
- Goals: Reduce snack collect from 30 to 22. Keep bomb create at 2.
- Moves: Reduce from 18 to 15
- Pre-placed tiles: Original at [3,3] and [4,4]. In 7x7 cross, both positions are active. Keep as-is.

**Level 9** (rounded rectangle, currently 8x8 with 60 active cells):
- New 7x7 cell_map (rounded rectangle, ~45 active cells):
```json
[
  [0, 1, 1, 1, 1, 1, 0],
  [1, 1, 1, 1, 1, 1, 1],
  [1, 1, 1, 1, 1, 1, 1],
  [1, 1, 1, 1, 1, 1, 1],
  [1, 1, 1, 1, 1, 1, 1],
  [1, 1, 1, 1, 1, 1, 1],
  [0, 1, 1, 1, 1, 1, 0]
]
```
Active cells: 45 (down from 60)
- Goals: Reduce ice destroy from 9 to 9 (keep same -- obstacle count stays). Keep grass destroy at 6.
- Moves: Reduce from 25 to 20
- Obstacles: Original ice at [3,3],[3,4],[4,3] -- still valid in 7x7. Original grass at [1,1],[6,6] -- [6,6] is inactive in new map! Move to [5,5] (active). Crate at [2,5],[5,2] -- both valid.

**Level 10** (S-shape/zigzag, currently 8x8 with 48 active cells):
- New 7x7 cell_map (S-shape, ~35 active cells):
```json
[
  [1, 1, 1, 1, 0, 0, 0],
  [1, 1, 1, 1, 0, 0, 0],
  [1, 1, 1, 1, 1, 0, 0],
  [0, 0, 1, 1, 1, 0, 0],
  [0, 0, 1, 1, 1, 1, 1],
  [0, 0, 0, 0, 1, 1, 1],
  [0, 0, 0, 0, 1, 1, 1]
]
```
Active cells: 35 (down from 48)
- Goals: Reduce burger collect from 30 to 22. Reduce ice destroy from 6 to 6 (keep same). Reduce grass destroy from 6 to 6 (keep same).
- Moves: Reduce from 28 to 22
- Obstacles: Original ice at [1,1],[2,4]. [1,1] is active, [2,4] is active. Keep as-is. Original grass at [5,5],[6,6]. [5,5] is inactive! [6,6] is active. Move grass to [[4,5],[6,5]] (both active).
- Pre-placed tiles: Original at [3,3]. Still active in new map. Keep as-is.

For EVERY file, ensure:
1. `"width": 7, "height": 7`
2. cell_map is exactly 7 rows of 7 values each
3. Every obstacle position [r,c] has r<7 AND c<7 AND (if cell_map exists) cell_map[r][c]==1
4. Every pre_placed_tile position has row<7 AND col<7 AND (if cell_map exists) cell_map[row][col]==1
5. Spawn rules unchanged
  </action>
  <verify>
For each file L6-L10, run validation:
```bash
python3 -c "
import json
for i in range(6,11):
  f = f'public/data/levels/level_{i:03d}.json'
  d = json.load(open(f))
  g = d['grid']
  assert g['width'] == 7 and g['height'] == 7, f'{f}: wrong grid size'
  cm = g.get('cell_map')
  if cm:
    assert len(cm) == 7, f'{f}: cell_map rows != 7'
    for row in cm:
      assert len(row) == 7, f'{f}: cell_map cols != 7'
  for o in d.get('obstacles',[]):
    for p in o['positions']:
      assert p[0] < 7 and p[1] < 7, f'{f}: obstacle OOB {p}'
      if cm: assert cm[p[0]][p[1]] == 1, f'{f}: obstacle on inactive cell {p}'
  for t in d.get('pre_placed_tiles',[]):
    assert t['row'] < 7 and t['col'] < 7, f'{f}: pre-placed OOB'
    if cm: assert cm[t['row']][t['col']] == 1, f'{f}: pre-placed on inactive cell'
  print(f'{f}: OK')
"
```
  </verify>
  <done>Levels 6-10 all have 7x7 grids with redesigned cell_maps preserving original shape aesthetic, valid obstacle/pre-placed positions on active cells, and balanced goals/moves for smaller boards.</done>
</task>

</tasks>

<verification>
1. All 10 level files have `"width": 7, "height": 7`
2. All cell_maps are exactly 7x7 arrays
3. No obstacle or pre-placed tile positions reference row/col >= 7
4. All obstacles and pre-placed tiles are on active cells (cell_map[r][c]==1 where applicable)
5. `npx tsc --noEmit` compiles without errors (level JSONs are loaded at runtime, but no TS type changes needed)
6. Goals are proportionally reduced for smaller board area
</verification>

<success_criteria>
- Every level_*.json has width:7, height:7
- Shaped levels (L6-L10) have correctly dimensioned 7x7 cell_maps with recognizable shapes
- All obstacle and pre-placed tile positions land on active cells
- Goal counts and move counts are adjusted downward proportionally (roughly 75-80% of original for full-board levels)
- No validation errors from position-checking script
</success_criteria>

<output>
After completion, create `.planning/phases/24-7x7-board-transition/24-02-SUMMARY.md`
</output>
