---
phase: 24-7x7-board-transition
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/utils/constants.ts
  - src/game/Match3Engine.test.ts
autonomous: true

must_haves:
  truths:
    - "Match3Engine works correctly with 7x7 grid dimensions"
    - "All existing tests pass with 7x7 default engine size"
    - "Global GRID_WIDTH and GRID_HEIGHT constants reflect 7x7"
  artifacts:
    - path: "src/utils/constants.ts"
      provides: "7x7 grid dimension constants"
      contains: "GRID_WIDTH = 7"
    - path: "src/game/Match3Engine.test.ts"
      provides: "Tests using 7x7 default engine"
      contains: "new Match3Engine(7, 7)"
  key_links:
    - from: "src/game/Match3Engine.test.ts"
      to: "src/game/Match3Engine.ts"
      via: "constructor(7, 7)"
      pattern: "new Match3Engine\\(7, 7\\)"
---

<objective>
Update engine constants and tests to use 7x7 grid dimensions instead of 8x8.

Purpose: Prepare the game engine layer for 7x7 boards. While Match3Engine takes rows/cols from the constructor (driven by level JSON), the global constants and test defaults should reflect the new standard dimension.

Output: Updated constants file and test file, all tests passing with 7x7 dimensions.
</objective>

<execution_context>
@/Users/vasiliyhrebenuyk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vasiliyhrebenuyk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/utils/constants.ts
@src/game/Match3Engine.test.ts
@src/game/Match3Engine.ts
@src/game/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update grid constants and tests to 7x7</name>
  <files>src/utils/constants.ts, src/game/Match3Engine.test.ts</files>
  <action>
1. In `src/utils/constants.ts`:
   - Change `GRID_WIDTH = 8` to `GRID_WIDTH = 7`
   - Change `GRID_HEIGHT = 8` to `GRID_HEIGHT = 7`
   Note: These constants are NOT currently imported anywhere (Game.ts reads from levelData.grid.width/height), but they should reflect the new standard for future use and documentation accuracy.

2. In `src/game/Match3Engine.test.ts`:
   - Change the default engine instantiation in `beforeEach` from `new Match3Engine(8, 8)` to `new Match3Engine(7, 7)`
   - Update ALL hardcoded `8` references in test loops and assertions that assume 8x8 grid size:
     - Grid dimension check: `expect(grid.length).toBe(8)` -> `toBe(7)`, `expect(grid[0].length).toBe(8)` -> `toBe(7)`
     - Non-adjacent same tiles test: loop `for (let row = 0; row < 8; row++)` -> `< 7` and `for (let col = 0; col < 8; col++)` -> `< 7`
     - 9-type spawn test: loops `for (let row = 0; row < 8; row++)` -> `< 7` and `for (let col = 0; col < 8; col++)` -> `< 7`, update comment "64 cells" -> "49 cells"
     - Gravity bottom row: `grid[7][...]` -> `grid[6][...]` (bottom row of 7x7 is index 6)
     - Gravity remove bottom row: `for (let col = 0; col < 8; col++) grid[7][col]...` -> `< 7` and `grid[6][col]...`
     - Cascade depth test: `for (let row = 0; row < 8; row++) grid[row][0]...` -> `< 7`
     - isCellActive test: `expect(engine.isCellActive(7, 7)).toBe(true)` -> `(6, 6)` (max valid index)
     - Obstacle tests: Any position references at row 7 should go to row 6, any that reference cells at indices >= 7 should be adjusted to <= 6
   - Do NOT change tests that intentionally use custom engine sizes (e.g., `new Match3Engine(5, 5)`, `new Match3Engine(3, 3)`, etc.) -- those are fine as-is

3. Run `npx vitest run --globals` and ensure all Match3Engine and BoosterActivator tests pass. (LevelManager tests have a pre-existing failure unrelated to this change -- ignore those 2 failures.)
  </action>
  <verify>Run `npx vitest run --globals` -- Match3Engine tests (all ~40 tests) and BoosterActivator tests (all ~15 tests) must pass. Only acceptable failures are the 2 pre-existing LevelManager test failures.</verify>
  <done>GRID_WIDTH=7, GRID_HEIGHT=7 in constants.ts. Match3Engine.test.ts uses 7x7 default engine. All engine and booster tests pass.</done>
</task>

</tasks>

<verification>
1. `npx vitest run --globals` passes with no new failures (same 2 LevelManager failures as before)
2. `grep 'GRID_WIDTH = 7' src/utils/constants.ts` returns a match
3. `grep 'GRID_HEIGHT = 7' src/utils/constants.ts` returns a match
4. `grep 'new Match3Engine(7, 7)' src/game/Match3Engine.test.ts` returns matches for the default engine
5. No references to `grid[7]` remain in Match3Engine.test.ts (since max valid row is 6 for 7x7)
</verification>

<success_criteria>
- Global grid constants updated to 7x7
- All Match3Engine and BoosterActivator tests pass with 7x7 default dimensions
- No hardcoded 8x8 assumptions remain in test file
</success_criteria>

<output>
After completion, create `.planning/phases/24-7x7-board-transition/24-01-SUMMARY.md`
</output>
