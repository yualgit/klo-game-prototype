---
phase: 17-header-navigation-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/scenes/Boot.ts
  - src/game/constants.ts
  - src/scenes/UIScene.ts
autonomous: true

must_haves:
  truths:
    - "Settings icon renders inside a blue square button container image (gui/Small Square Button Blue.png)"
    - "Bonus score display (money emoji + number) is not visible in the header"
    - "Levels tab appears before Collections tab in bottom navigation bar"
    - "Active tab indicator is a rounded rectangle, not a circle"
  artifacts:
    - path: "src/scenes/Boot.ts"
      provides: "Small Square Button Blue texture loaded"
      contains: "gui_small_square_button_blue"
    - path: "src/game/constants.ts"
      provides: "GUI texture key for small square button"
      contains: "smallSquareButtonBlue"
    - path: "src/scenes/UIScene.ts"
      provides: "Updated header and navigation rendering"
  key_links:
    - from: "src/scenes/Boot.ts"
      to: "src/scenes/UIScene.ts"
      via: "texture key gui_small_square_button_blue loaded in Boot, used in UIScene"
      pattern: "gui_small_square_button_blue"
    - from: "src/game/constants.ts"
      to: "src/scenes/UIScene.ts"
      via: "GUI_TEXTURE_KEYS constant referenced in UIScene"
      pattern: "GUI_TEXTURE_KEYS"
---

<objective>
Polish the UIScene header and bottom navigation to match v1.3 design requirements.

Purpose: The header currently shows a plain emoji gear for settings and displays bonus score that should be removed. The bottom navigation active tab indicator uses a circle instead of a rounded rectangle. These visual refinements bring the UI shell to production quality.

Output: Updated UIScene with settings button container, removed bonus display, correct tab ordering, and rounded rectangle active tab indicator.
</objective>

<execution_context>
@/Users/vasiliyhrebenuyk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vasiliyhrebenuyk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/scenes/UIScene.ts
@src/scenes/Boot.ts
@src/game/constants.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Load Small Square Button Blue texture and add constant</name>
  <files>src/scenes/Boot.ts, src/game/constants.ts</files>
  <action>
1. In `src/scenes/Boot.ts`, add a new image load line in the GUI elements section (after line 107):
   ```
   this.load.image('gui_small_square_button_blue', 'assets/gui/Small Square Button Blue.png');
   ```

2. In `src/game/constants.ts`, add a new entry to `GUI_TEXTURE_KEYS` object:
   ```
   smallSquareButtonBlue: 'gui_small_square_button_blue',
   ```
   Add it after the existing button entries (after `buttonGreen` line).
  </action>
  <verify>Run `npx tsc --noEmit` to confirm no TypeScript errors. Grep for `gui_small_square_button_blue` in Boot.ts and constants.ts to confirm both additions exist.</verify>
  <done>The texture key `gui_small_square_button_blue` is registered in Boot.ts preload and available as `GUI_TEXTURE_KEYS.smallSquareButtonBlue` in constants.</done>
</task>

<task type="auto">
  <name>Task 2: Polish header and navigation in UIScene</name>
  <files>src/scenes/UIScene.ts</files>
  <action>
Apply four changes to UIScene.ts:

**HDR-01 ‚Äî Settings button container:**
Replace the settings gear emoji text object with an Image-based button. In `createHeader()`:
- Create a Phaser Image using texture `'gui_small_square_button_blue'` positioned at `width - cssToGame(25), headerHeight / 2`.
- Set display size to approximately `cssToGame(32) x cssToGame(32)` (square container).
- Set origin 0.5, scrollFactor 0, depth 201.
- Place the `'‚öô'` gear text ON TOP of the button image (depth 202), centered at same position.
- Make the image interactive (not the text) with `useHandCursor: true` and emit `'open-settings'` on pointerup.
- Store the button image as a new class property `settingsButton` (type `Phaser.GameObjects.Image | null = null`).
- Keep `settingsGear` as the gear text on top.
- Update `destroyAllElements()` to also destroy `this.settingsButton`.

**HDR-02 ‚Äî Remove bonus display:**
- Remove the `bonusIcon` creation block (lines ~98-104 in createHeader).
- Remove the `bonusText` creation block (lines ~107-115 in createHeader).
- Remove the `onBonusesChanged` method entirely.
- Remove the `economy.on('bonuses-changed', ...)` subscription from `setupReactiveUpdates()`.
- Remove `economy.off('bonuses-changed', ...)` from `destroyAllElements()` and `onShutdown()`.
- Remove `bonusIcon` and `bonusText` destroy calls from `destroyAllElements()`.
- Remove `bonusIcon` and `bonusText` class properties.
- Remove `this.onBonusesChanged()` initial call from `setupReactiveUpdates()`.

**NAV-01 ‚Äî Tab ordering:**
Verify/ensure that in `createBottomNav()` the three `createTabButton` calls are ordered:
1. `width * 0.17` ‚Äî Levels ('–†—ñ–≤–Ω—ñ', 'üó∫', 'levels')
2. `width * 0.5` ‚Äî Collections ('–ö–æ–ª–µ–∫—Ü—ñ—ó', 'üÉè', 'collections')
3. `width * 0.83` ‚Äî Shop ('–ú–∞–≥–∞–∑–∏–Ω', 'üõí', 'shop')
This is the current order. Confirm it matches and do NOT change it (the requirement's success criteria is "Levels tab appears before Collections tab" which is already correct).

**NAV-02 ‚Äî Rounded rectangle active indicator:**
In `createTabButton()`, replace the active tab circle indicator:
```typescript
// BEFORE (circle):
const glow = this.add.circle(x, navCenterY - cssToGame(6), cssToGame(20), 0xffb800, 0.15);

// AFTER (rounded rectangle):
const glow = this.add.graphics();
const rectW = cssToGame(44);
const rectH = cssToGame(28);
glow.fillStyle(0xffb800, 0.15);
glow.fillRoundedRect(x - rectW / 2, navCenterY - cssToGame(6) - rectH / 2, rectW, rectH, cssToGame(8));
glow.setScrollFactor(0);
glow.setDepth(201);
```
Remove the separate setScrollFactor and setDepth lines that were on the old circle (they're now set directly on the graphics object).

Ensure the gear text font size is slightly smaller (e.g., `cssToGame(16)px`) so it fits nicely within the square button container image.
  </action>
  <verify>
1. Run `npx tsc --noEmit` ‚Äî no TypeScript errors.
2. Run the dev server (`npx vite --open`) and visually confirm:
   - Settings icon shows inside a blue square button
   - No bonus/money display in header
   - Bottom nav order is Levels, Collections, Shop (left to right)
   - Active tab has rounded rectangle highlight, not circle
  </verify>
  <done>
- Settings gear renders inside the blue square button container image
- Bonus icon and bonus text are completely removed from the header
- Tab order is Levels (left), Collections (center), Shop (right)
- Active tab indicator is a rounded rectangle with 0xffb800 color at 0.15 opacity
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors
2. Visual inspection: header shows hearts (centered) and settings button (right) only ‚Äî no bonus display
3. Visual inspection: settings button is a gear icon inside a blue square button container
4. Visual inspection: bottom nav tabs ordered Levels, Collections, Shop from left to right
5. Visual inspection: active tab has rounded rectangle indicator, not circle
6. Settings button click opens settings overlay (functional test)
</verification>

<success_criteria>
- Settings icon renders inside gui/Small Square Button Blue.png container
- Bonus score display is removed from header
- "Levels" tab appears before "Collections" tab in bottom navigation
- Active tab indicator is a rounded rectangle instead of circle
- No TypeScript compilation errors
</success_criteria>

<output>
After completion, create `.planning/phases/17-header-navigation-polish/17-01-SUMMARY.md`
</output>
