---
phase: 19-settings-overlay-fixes
plan: 02
type: execute
wave: 1
depends_on: ["19-01"]
files_modified: [src/scenes/UIScene.ts]
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Settings panel title fits mobile panel width without looking oversized"
    - "Toggle switches are proportional to the panel width on narrow mobile screens"
    - "Volume label and slider are on separate rows (not competing horizontally)"
    - "All controls fit within the panel with adequate spacing, no overlaps"
  artifacts:
    - path: "src/scenes/UIScene.ts"
      provides: "Resized settings overlay controls for mobile"
      contains: "cssToGame(18)"
  key_links:
    - from: "showSettingsOverlay title"
      to: "panel width"
      via: "reduced font size cssToGame(18)"
      pattern: "cssToGame\\(18\\)"
    - from: "volume label row"
      to: "volume slider row"
      via: "separate Y positions (2-row layout)"
      pattern: "volumeSliderY"
---

<objective>
Fix settings overlay mobile sizing issues reported in UAT: title font too large, toggles too big for narrow panels, volume slider overlapping its label on same row.

Purpose: UAT Test #3 failed because fixed cssToGame sizes overflow on narrow mobile panels (~270-320 CSS px wide). User reported title, toggles, and volume slider all too large / overlapping.
Output: Updated showSettingsOverlay() in UIScene.ts with smaller controls and 2-row volume layout.
</objective>

<execution_context>
@/Users/vasiliyhrebenuyk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vasiliyhrebenuyk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-settings-overlay-fixes/19-01-SUMMARY.md
@.planning/phases/19-settings-overlay-fixes/19-UAT-diagnosis.md
@src/scenes/UIScene.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Resize settings overlay controls for mobile fit</name>
  <files>src/scenes/UIScene.ts</files>
  <action>
Modify `showSettingsOverlay()` method in UIScene.ts (lines 363-633). All changes are within this single method. The rest of UIScene.ts must not be touched.

**1. Title font size (line 409):**
- Change `fontSize: cssToGame(22)` to `fontSize: cssToGame(18)`
- This reduces the title from 22 CSS px to 18 CSS px, fitting "Налаштування" comfortably on narrow panels

**2. Toggle dimensions (both SFX and Animation toggles):**
- Change `toggleWidth` from `cssToGame(60)` to `cssToGame(44)` (line 441)
- Change `toggleHeight` from `cssToGame(30)` to `cssToGame(22)` (line 442)
- Change SFX toggle thumb radius from `cssToGame(12)` to `cssToGame(9)` (line 437)
- Change Animation toggle thumb radius from `cssToGame(12)` to `cssToGame(9)` (line 562)
- Update thumb positioning offsets in both toggles: change `cssToGame(16)` (thumb offset inside track) to `cssToGame(11)` in ALL 4 locations:
  - SFX updateSfxToggle (line 450): `sfxToggleX + toggleWidth - cssToGame(11)` and `sfxToggleX + cssToGame(11)`
  - SFX pointerup handler (line 470): same pattern
  - Animation updateAnimToggle (line 573): `animToggleX + toggleWidth - cssToGame(11)` and `animToggleX + cssToGame(11)`
  - Animation pointerup handler (line 593): same pattern

**3. Volume control - split into 2 rows:**
- Keep volume label at current Y position: `volumeRowY = panelY + cssToGame(145)`
- But change the label to be left-aligned at `panelX + cssToGame(30)` with origin `(0, 0.5)` (already correct)
- Add a NEW Y position for the slider: `const volumeSliderY = panelY + cssToGame(175)` (30 CSS px below label)
- Move ALL slider elements (track, fill, thumb) from `volumeRowY` to `volumeSliderY`
- Center the slider track horizontally within the panel: `const sliderTrackX = panelX + cssToGame(30)` (same left padding as labels)
- Reduce slider track width: `const sliderTrackW = panelW - cssToGame(60)` (30px padding on each side, so it spans the panel interior)
- Reduce slider thumb radius from `cssToGame(10)` to `cssToGame(8)` (line 516)
- Reduce slider thumb stroke width from `cssToGame(2)` to `cssToGame(1.5)` (line 517)

**4. Row Y positions - adjust for new 2-row volume layout:**
- SFX row: keep at `panelY + cssToGame(85)` (was 80, move down slightly for breathing room from smaller title)
- Volume label row: `panelY + cssToGame(140)` (was 145, adjust slightly)
- Volume slider row: `panelY + cssToGame(170)` (NEW - 30px below label)
- Animation row: `panelY + cssToGame(225)` (was 210, pushed down to accommodate 2-row volume)
- Close button: `panelY + cssToGame(290)` (was 280, pushed down proportionally)

**5. Panel height:**
- Change `panelH` from `cssToGame(340)` to `cssToGame(360)` (line 394) to accommodate the extra volume slider row
- The close button at cssToGame(290) + button height cssToGame(36) = 326 CSS px, fitting within 360 with 34px bottom margin

**6. Label font sizes (optional, proportional reduction):**
- Keep label font sizes at `cssToGame(15)` -- they are already appropriate
- Keep close button font at `cssToGame(14)` -- already appropriate

**Important: Do NOT change any code outside showSettingsOverlay(). Do NOT change the panel width calculation, depth values, singleton guard, backdrop, or close button logic (other than Y position).**
  </action>
  <verify>
1. `npx tsc --noEmit` passes with 0 errors
2. `npx vite build` succeeds
3. Grep confirms new values are present:
   - `grep "cssToGame(18)" src/scenes/UIScene.ts` shows title font size
   - `grep "cssToGame(44)" src/scenes/UIScene.ts` shows toggle width
   - `grep "cssToGame(22)" src/scenes/UIScene.ts` shows toggle height
   - `grep "volumeSliderY" src/scenes/UIScene.ts` shows 2-row volume layout
   - `grep "cssToGame(360)" src/scenes/UIScene.ts` shows increased panel height
  </verify>
  <done>
- Title uses cssToGame(18) font size (down from 22)
- Toggle dimensions are 44x22 CSS px (down from 60x30) with 9px thumb radius (down from 12)
- Volume label and slider are on separate rows (volumeSliderY ~30px below volumeRowY)
- Slider track spans panel interior width with 8px thumb radius
- Panel height increased to 360 to accommodate extra row
- All row Y positions adjusted for new layout
- TypeScript compiles, Vite builds
  </done>
</task>

</tasks>

<verification>
1. TypeScript compilation: `npx tsc --noEmit` -- 0 errors
2. Production build: `npx vite build` -- succeeds
3. Settings overlay method still exists with singleton guard
4. All overlay elements still at depth 300+
5. New sizing values present in code (grep checks in task verify)
</verification>

<success_criteria>
Settings overlay controls are resized for mobile: title 18px, toggles 44x22, volume on 2 rows, panel height 360. Code compiles and builds. Ready for UAT re-test on mobile device.
</success_criteria>

<output>
After completion, create `.planning/phases/19-settings-overlay-fixes/19-02-SUMMARY.md`
</output>
