---
phase: 14-collection-data-model-viewing
plan: 02
type: execute
wave: 2
depends_on: ["14-01"]
files_modified:
  - src/scenes/Boot.ts
  - src/scenes/Collections.ts
autonomous: false

must_haves:
  truths:
    - "Collections screen shows 3 collections (Coffee/Food/Cars) on vertically scrollable page"
    - "Each collection displays Ukrainian name, reward description, 6-card grid, and progress X/6"
    - "Uncollected cards shown as grayscale silhouette with '?' overlay; collected cards in full color"
    - "Drag scrolling works to navigate between collections"
    - "Collections scene integrates with UIScene (header + bottom nav visible)"
  artifacts:
    - path: "src/scenes/Boot.ts"
      provides: "Card texture loading (18 card PNGs + blank placeholder)"
      contains: "collection_coffee_01"
    - path: "src/scenes/Collections.ts"
      provides: "Full collection viewing UI with scrollable grid layout"
      min_lines: 100
  key_links:
    - from: "src/scenes/Collections.ts"
      to: "src/game/CollectionsManager.ts"
      via: "registry.get('collections') for card ownership queries"
      pattern: "registry\\.get\\('collections'\\)"
    - from: "src/scenes/Collections.ts"
      to: "src/game/collectionConfig.ts"
      via: "imports card definitions and collection metadata"
      pattern: "import.*collectionConfig"
    - from: "src/scenes/Boot.ts"
      to: "public/assets/collections/"
      via: "this.load.image for 18 card textures"
      pattern: "load\\.image\\('collection_"
---

<objective>
Replace the Collections stub scene with a fully functional collection viewing UI: scrollable vertical layout showing 3 collections with card grids, grayscale uncollected cards, progress tracking, and proper UIScene integration.

Purpose: Delivers the visual collection browsing experience that players use to track their card progress. This is the core UI of the collections feature.
Output: Working Collections scene with scrollable card grid, grayscale/color card states, and progress display.
</objective>

<execution_context>
@/Users/vasiliyhrebenuyk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vasiliyhrebenuyk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-collection-data-model-viewing/14-01-SUMMARY.md

# Key references
@src/scenes/Collections.ts — Current stub scene to replace (has UIScene integration pattern)
@src/scenes/Boot.ts — Asset loading location (add card textures here)
@src/scenes/LevelSelect.ts — Camera scroll pattern reference (pointermove + scrollY)
@src/game/collectionConfig.ts — Card definitions and collection metadata (from Plan 01)
@src/game/CollectionsManager.ts — Collection state queries (from Plan 01)
@src/utils/responsive.ts — cssToGame() for DPR-aware sizing
</context>

<tasks>

<task type="auto">
  <name>Task 1: Load card textures in Boot and implement Collections scene UI</name>
  <files>
    src/scenes/Boot.ts
    src/scenes/Collections.ts
  </files>
  <action>
**Part A: Add card texture loading to Boot.ts**

Add collection card asset loading in the `preload()` method of Boot.ts, after the existing GUI elements section and before the sound effects section. Load all 18 card PNGs plus the blank placeholder:

```typescript
// --- Load collection card assets ---
// Coffee collection
this.load.image('collection_coffee_01', 'assets/collections/coffee/01_espresso.png');
this.load.image('collection_coffee_02', 'assets/collections/coffee/02_americano.png');
this.load.image('collection_coffee_03', 'assets/collections/coffee/03_latte.png');
this.load.image('collection_coffee_04', 'assets/collections/coffee/04_capucino.png');
this.load.image('collection_coffee_05', 'assets/collections/coffee/05_flatwhite.png');
this.load.image('collection_coffee_06', 'assets/collections/coffee/06_raf.png');

// Food collection
this.load.image('collection_food_01', 'assets/collections/food/01_hotdog.png');
this.load.image('collection_food_02', 'assets/collections/food/02_cruassan.png');
this.load.image('collection_food_03', 'assets/collections/food/03_burger.png');
this.load.image('collection_food_04', 'assets/collections/food/04_pizza.png');
this.load.image('collection_food_05', 'assets/collections/food/05_combo.png');
this.load.image('collection_food_06', 'assets/collections/food/06_klo_hotdog.png');

// Car collection
this.load.image('collection_car_01', 'assets/collections/car/01_red_car.png');
this.load.image('collection_car_02', 'assets/collections/car/02_blue_car.png');
this.load.image('collection_car_03', 'assets/collections/car/03_suv.png');
this.load.image('collection_car_04', 'assets/collections/car/04_outlander.png');
this.load.image('collection_car_05', 'assets/collections/car/05_sportcar.png');
this.load.image('collection_car_06', 'assets/collections/car/06_lux_car.png');

// Blank card placeholder for uncollected cards
this.load.image('collection_blank', 'assets/collections/blank.png');
```

Texture key naming convention: `collection_{collectionId}_{cardNumber}` — matches the `textureKey` field in CARD_DEFINITIONS from collectionConfig.ts.

**Part B: Replace Collections stub with full collection viewing UI**

Completely rewrite `src/scenes/Collections.ts`. Keep the existing UIScene integration pattern (scene.launch, eventsCenter navigation, shutdown cleanup) but replace placeholder content with real collection grid.

**Layout structure (vertical scroll):**

```
[UIScene Header — lives, bonuses, settings gear] (managed by UIScene)
  |
  | <- scrollable area starts below UIScene header
  |
  [Collection 1: Coffee]
    - Collection name (bold, larger font)
    - Reward description (smaller, gray)
    - 6-card grid (2 rows x 3 cols)
      - Owned: full color card image
      - Unowned: card image with gray tint (0x808080) + alpha(0.4) + "?" text overlay
    - Progress text: "X/6" below grid
  |
  [Collection 2: Food]
    - (same layout)
  |
  [Collection 3: Cars]
    - (same layout)
  |
  [Bottom padding for scroll]
  |
[UIScene Bottom Nav — Levels | Collections | Shop] (managed by UIScene)
```

**Implementation details:**

1. **Camera scrolling:** Follow LevelSelect pattern.
   - Calculate total world height = (UIScene header offset) + (3 collections * collectionBlockHeight) + (bottom nav safe area) + viewport padding
   - `this.cameras.main.setBounds(0, 0, width, worldHeight)`
   - Drag scroll via `pointermove` with `pointer.isDown` check
   - Clamp scrollY within bounds (camera handles this via setBounds)
   - **IMPORTANT per research pitfall:** Add viewport height to world height so last collection is fully scrollable into view

2. **Collection block rendering:**
   - Use `this.add.container(x, y)` for each collection block (NOT Phaser containers for the whole page — just individual collection groups)
   - Alternatively, add all elements directly to the scene world (simpler, proven in LevelSelect)
   - Each collection block height: approximately cssToGame(350) — enough for title + description + 2-row card grid + progress text

3. **Card grid (2 rows x 3 columns):**
   - Card display size: cssToGame(80) x cssToGame(80) (good touch target)
   - Gap between cards: cssToGame(12)
   - Center grid horizontally within viewport
   - For each card, check `collectionsManager.isCardOwned(collectionId, cardId)`
   - **Owned cards:** `this.add.image(x, y, textureKey).setDisplaySize(cardSize, cardSize)`
   - **Unowned cards:** Load same card texture BUT apply `setTint(0x808080)` and `setAlpha(0.4)` for grayscale silhouette. Add "?" text overlay centered on the card (white text, bold, cssToGame(28) size)

4. **Text styling:**
   - Collection name: fontFamily 'Arial, sans-serif', fontSize cssToGame(22)px, bold, color '#1A1A1A'
   - Reward description: fontSize cssToGame(14)px, normal weight, color '#888888'
   - Progress "X/6": fontSize cssToGame(16)px, color '#666666'
   - "?" overlay: fontSize cssToGame(28)px, bold, color '#FFFFFF'
   - All text uses cssToGame() for DPR-aware sizing

5. **UIScene integration (PRESERVE from stub):**
   - `this.scene.launch('UIScene', { currentTab: 'collections', showBottomNav: true, showHeader: true })`
   - `eventsCenter.on('navigate-to', this.handleNavigation, this)`
   - `eventsCenter.on('open-settings', this.showSettings, this)`
   - Shutdown cleanup: off all events, stop UIScene, off resize handler
   - **Keep handleNavigation and showSettings methods identical to current stub**

6. **Resize handling:**
   - On resize: update camera viewport, recalculate setBounds with new width, rebuild all collection UI elements
   - Store references to all created game objects for cleanup during resize/shutdown
   - Follow the `handleResize` pattern from LevelSelect (destroy and recreate content)

7. **Scroll start position:**
   - Start Y offset = cssToGame(60) (below UIScene header — 50px header + 10px padding)
   - Account for UIScene bottom nav height at the bottom (cssToGame(70) safe zone)

8. **Background:**
   - Keep the gradient background from stub: `fillGradientStyle(0xF9F9F9, 0xF9F9F9, 0xFFF5E0, 0xFFF5E0, 1)`
   - Background should cover full world height (not just viewport)

**Rarity badge (nice-to-have but simple):**
- Add a small colored dot or text indicator next to each card showing rarity
- Colors: common = gray (#888), rare = blue (#4488FF), epic = purple (#AA44FF), legendary = gold (#FFB800)
- Only show on OWNED cards. Size: cssToGame(8) circle positioned at bottom-right of card.

**DO NOT:**
- Add animations (Phase 16 concern)
- Add tap-to-zoom on cards (not in requirements)
- Add exchange button (Phase 16)
- Add event emission from CollectionsManager (Phase 16)
- Use Rex UI plugins (camera scroll is simpler and proven)
  </action>
  <verify>
1. `npx tsc --noEmit` — TypeScript compilation passes
2. `npm run dev` — navigate to Collections via bottom nav
3. Verify all 3 collections visible with scroll
4. Verify card grid shows 6 cards per collection (all grayed out for new user)
5. Verify "?" overlays appear on uncollected cards
6. Verify progress shows "0/6" for each collection
7. Verify drag scrolling works to see all 3 collections
8. Verify UIScene header and bottom nav remain visible and functional
  </verify>
  <done>
Collections scene shows 3 collections (Coffee/Food/Cars) in scrollable vertical layout. Each collection displays Ukrainian name, reward description, 6-card grid with grayscale silhouettes for uncollected cards (gray tint + "?" overlay), and progress counter. Card textures loaded in Boot scene. UIScene integration preserved (header + bottom nav + navigation).
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Visual verification of Collections UI</name>
  <files>src/scenes/Collections.ts</files>
  <action>
Human verifies the full Collections scene UI. What was built:
- Full Collections scene with scrollable card grid
- Grayscale uncollected cards with "?" overlay
- UIScene integration (header + bottom nav)
- 3 collections: Coffee, Food, Cars with progress tracking
  </action>
  <verify>
1. Run `npm run dev` and open browser
2. From Level Select, tap the "Collections" tab in bottom nav
3. Verify: Collections scene loads with gradient background
4. Verify: UIScene header visible at top (lives, bonuses, settings gear)
5. Verify: UIScene bottom nav visible at bottom with Collections tab highlighted
6. Verify: First collection (Coffee) visible with:
   - Title "Кава" in bold
   - Reward description "Безкоштовна кава в KLO"
   - 6 cards in 2x3 grid, all grayed out with "?" overlays (new user has no cards)
   - Progress text "0/6"
7. Scroll down: verify Food collection ("Їжа") and Car collection ("Авто") appear with same layout
8. Verify: drag scrolling is smooth and last collection (Cars) is fully visible when scrolled to bottom
9. Verify: tap "Levels" tab in bottom nav navigates back to Level Select
10. Verify: tap "Shop" tab navigates to Shop stub scene
11. Open browser DevTools console: verify no errors related to collections or textures
12. (Optional) Test on mobile viewport (375x667): verify cards are readable and tappable size
  </verify>
  <done>Human approves Collections UI: 3 collections with card grids, grayscale states, scrolling, and navigation all working correctly</done>
</task>

</tasks>

<verification>
1. Boot scene loads all 18 card textures + blank placeholder without errors
2. Collections scene renders 3 collections with proper layout
3. Card grid shows correct visual states (gray+? for unowned, color for owned)
4. Drag scroll navigates between collections smoothly
5. UIScene header + bottom nav visible and functional
6. Navigation between tabs works correctly
7. No console errors
</verification>

<success_criteria>
- 3 collections visible on scrollable page (Coffee/Food/Cars)
- Each collection shows name, reward, 6-card grid, progress X/6
- Uncollected cards are grayscale silhouette with "?" overlay
- Collected cards would show in full color (verified by data model, visual in Phase 15)
- Drag scrolling works, last collection fully accessible
- UIScene integration preserved (header, bottom nav, navigation)
</success_criteria>

<output>
After completion, create `.planning/phases/14-collection-data-model-viewing/14-02-SUMMARY.md`
</output>
