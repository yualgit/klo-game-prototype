---
phase: 02-core-grid-mechanics
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/game/TileSprite.ts
  - src/game/constants.ts
autonomous: true

must_haves:
  truths:
    - "TileSprite displays colored tile based on type"
    - "TileSprite can be positioned by row/col"
    - "TileSprite can show selected state"
    - "TileSprite can be reset for object pooling"
  artifacts:
    - path: "src/game/TileSprite.ts"
      provides: "Phaser sprite wrapper for tiles"
      exports: ["TileSprite"]
      min_lines: 60
    - path: "src/game/constants.ts"
      provides: "Tile type colors and game constants"
      exports: ["TILE_COLORS", "TILE_TYPES"]
  key_links:
    - from: "src/game/TileSprite.ts"
      to: "src/game/constants.ts"
      via: "imports"
      pattern: "import.*TILE_COLORS"
---

<objective>
Create TileSprite class that wraps Phaser graphics for tile visualization, supporting the four tile types (fuel, coffee, snack, road) with programmatic drawing.

Purpose: Provides the visual layer that will render Match3Engine state. Designed for object pooling with reset capability.

Output: TileSprite class ready for use in Game scene object pool.
</objective>

<execution_context>
@/Users/vasiliyhrebenuyk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vasiliyhrebenuyk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/02-core-grid-mechanics/02-RESEARCH.md
@src/scenes/Game.ts
@src/utils/constants.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TileSprite class with type-based rendering</name>
  <files>src/game/TileSprite.ts, src/game/constants.ts</files>
  <action>
Create src/game/constants.ts with:
- TILE_TYPES array: ['fuel', 'coffee', 'snack', 'road']
- TILE_COLORS map: { fuel: 0xffb800 (KLO yellow), coffee: 0x8b4513 (brown), snack: 0x3498db (blue), road: 0x27ae60 (green) }
- TILE_SIZE: 64 (import from utils/constants or define here)
- TILE_GAP: 4 (gap between tiles)

Create src/game/TileSprite.ts as Phaser.GameObjects.Container:
- Constructor takes scene, row, col, type
- Properties: row, col, type (public for engine sync)
- Private graphics object for drawing
- draw() method: clears graphics, draws rounded rect with TILE_COLORS[type], adds highlight
- setType(type) method: updates type and redraws
- setGridPosition(row, col) method: updates row/col, recalculates x/y
- setSelected(selected) method: adds/removes selection highlight (scale or glow effect)
- reset(type, row, col) method: for pool reuse - sets all properties and redraws
- Use existing drawTile pattern from Game.ts but as instance method

Coordinate calculation:
- x = offsetX + col * TILE_SIZE + TILE_SIZE / 2
- y = offsetY + row * TILE_SIZE + TILE_SIZE / 2
- Store offsetX/offsetY as static or pass to constructor

Do NOT modify Game.ts yet - that's Plan 03.
  </action>
  <verify>
TypeScript compiles without errors:
```bash
cd /Users/vasiliyhrebenuyk/work/KLO/klo-match-3 && npm run build 2>&1 | head -20
```
  </verify>
  <done>
- src/game/constants.ts exports TILE_TYPES, TILE_COLORS, TILE_SIZE, TILE_GAP
- src/game/TileSprite.ts exports TileSprite class extending Phaser.GameObjects.Container
- TileSprite has: constructor, draw, setType, setGridPosition, setSelected, reset methods
- Code compiles without Phaser runtime errors
  </done>
</task>

</tasks>

<verification>
```bash
npm run build
```
Build succeeds with no TypeScript errors.
</verification>

<success_criteria>
- TileSprite class exists with all documented methods
- Constants define all 4 tile types with distinct colors
- Class designed for object pooling (reset method)
- Ready for integration in Plan 03
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-grid-mechanics/02-02-SUMMARY.md`
</output>
