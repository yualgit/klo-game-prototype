---
phase: 25-new-levels
plan: 02
type: execute
wave: 2
depends_on: ["25-01"]
files_modified:
  - src/game/constants.ts
  - src/scenes/Boot.ts
  - src/scenes/LevelSelect.ts
  - src/scenes/Game.ts
  - src/scenes/CardPickOverlay.ts
autonomous: true

must_haves:
  truths:
    - "Level select map displays all 20 level nodes with Kyiv landmarks"
    - "Boot.ts loads all 20 level JSON files"
    - "Player can navigate to and play levels 11-20"
    - "Winning level 20 shows 'Меню' button (last level detection works)"
    - "Card pick overlay navigates correctly for levels beyond 10"
    - "Road path connects all 20 nodes on the scrollable map"
  artifacts:
    - path: "src/game/constants.ts"
      provides: "MAP_CONFIG with 20 LEVEL_NODES"
      contains: "LEVEL_NODES"
    - path: "src/scenes/Boot.ts"
      provides: "Level JSON loading for L11-L20"
      contains: "level_020"
    - path: "src/scenes/LevelSelect.ts"
      provides: "Level names for 20 levels"
      contains: "Кавовий ранок"
  key_links:
    - from: "src/scenes/LevelSelect.ts"
      to: "src/game/constants.ts"
      via: "MAP_CONFIG.LEVEL_NODES array length drives node creation loop"
      pattern: "MAP_CONFIG.LEVEL_NODES"
    - from: "src/scenes/Game.ts"
      to: "src/scenes/Boot.ts"
      via: "cache.json.get(level_NNN) loads level data"
      pattern: "MAX_LEVELS"
    - from: "src/scenes/CardPickOverlay.ts"
      to: "src/scenes/Game.ts"
      via: "MAX_LEVELS determines last level navigation"
      pattern: "MAX_LEVELS"
---

<objective>
Extend the level select map, loading, and navigation to support 20 levels.

Purpose: Wire up the 10 new level JSONs from Plan 01 so players can see, select, and play all 20 levels on the Kyiv map journey.

Output: Updated constants, Boot loader, LevelSelect scene, Game scene, and CardPickOverlay with 20-level support.
</objective>

<execution_context>
@/Users/vasiliyhrebenuyk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vasiliyhrebenuyk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Files to modify
@src/game/constants.ts
@src/scenes/Boot.ts
@src/scenes/LevelSelect.ts
@src/scenes/Game.ts
@src/scenes/CardPickOverlay.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend MAP_CONFIG and Boot.ts for 20 levels</name>
  <files>
    src/game/constants.ts
    src/scenes/Boot.ts
  </files>
  <action>
**constants.ts — Extend MAP_CONFIG:**

1. Update `MAP_HEIGHT` from 2200 to 4200 (double height for 20 nodes with same ~200px spacing)
2. Extend `LEVEL_NODES` array from 10 to 20 entries. Continue the winding path pattern (alternating x: 200 and 480) with ~200px vertical spacing. Assign 10 new Kyiv landmark labels for L11-L20.

New nodes to add (continuing from L10 at y:250):
```
{ x: 200, y: 50, label: 'Мистецький Арсенал' },     // L11 - not enough space above L10
```

Wait — the existing pattern goes from y:2050 (L1 bottom) UP to y:250 (L10 top). To add 10 more levels, we need to extend UPWARD (lower y values) or restructure.

**Better approach:** Since map scrolls from bottom to top, new levels should appear ABOVE existing ones. But y:250 is already near the top. So we need to:

1. Shift ALL existing node y-positions DOWN by 2000px (add 2000 to each y)
2. Place new L11-L20 nodes in the y:250-2050 range (where L1-L10 used to be, now the upper half)
3. Increase MAP_HEIGHT to 4400 to accommodate

Existing nodes shifted (add 2000):
```
L1:  { x: 200, y: 4050, label: 'Оболонь' }
L2:  { x: 480, y: 3850, label: 'Поштова площа' }
L3:  { x: 200, y: 3650, label: 'Контрактова' }
L4:  { x: 480, y: 3450, label: 'Андріївський' }
L5:  { x: 200, y: 3250, label: 'Золоті ворота' }
L6:  { x: 480, y: 3050, label: 'Хрещатик' }
L7:  { x: 200, y: 2860, label: 'Майдан' }
L8:  { x: 480, y: 2660, label: 'Бессарабка' }
L9:  { x: 200, y: 2460, label: 'Палац спорту' }
L10: { x: 480, y: 2250, label: 'Печерська Лавра' }
```

New nodes (continuing path upward from L10):
```
L11: { x: 200, y: 2050, label: 'Мистецький Арсенал' }
L12: { x: 480, y: 1850, label: 'Ботанічний сад' }
L13: { x: 200, y: 1650, label: 'Видубичі' }
L14: { x: 480, y: 1450, label: 'Родина-Мати' }
L15: { x: 200, y: 1250, label: 'Олімпійський' }
L16: { x: 480, y: 1050, label: 'Палац Україна' }
L17: { x: 200, y: 860, label: 'Університет' }
L18: { x: 480, y: 660, label: 'Софія Київська' }
L19: { x: 200, y: 460, label: 'Михайлівський' }
L20: { x: 480, y: 250, label: 'Арка Свободи' }
```

Update the MAP_CONFIG comment to say "20 nodes".

**Boot.ts — Add level loading:**

Add 10 new level JSON load statements after the existing 10, following the exact same pattern:
```typescript
this.load.json('level_011', 'data/levels/level_011.json');
this.load.json('level_012', 'data/levels/level_012.json');
// ... through level_020
this.load.json('level_020', 'data/levels/level_020.json');
```
  </action>
  <verify>
```bash
grep -c "LEVEL_NODES" src/game/constants.ts  # Should show MAP_CONFIG with 20 entries
grep "MAP_HEIGHT" src/game/constants.ts       # Should show 4400
grep -c "level_0" src/scenes/Boot.ts          # Should show 20 load lines
```
  </verify>
  <done>
MAP_CONFIG has 20 LEVEL_NODES with Kyiv landmarks spanning y:4050 to y:250, MAP_HEIGHT is 4400, and Boot.ts loads all 20 level JSONs.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update LevelSelect, Game, and CardPickOverlay for 20 levels</name>
  <files>
    src/scenes/LevelSelect.ts
    src/scenes/Game.ts
    src/scenes/CardPickOverlay.ts
  </files>
  <action>
**LevelSelect.ts:**

1. Extend `LEVEL_NAMES` record from 10 to 20 entries. Add Ukrainian names matching the level JSON names:
```typescript
11: 'Кавовий ранок',
12: 'Паливна станція',
13: 'Колесо фортуни',
14: 'Крижана дорога',
15: 'Бульбашкове поле',
16: 'Льодяний хрест',
17: 'Подвійний удар',
18: 'Фортеця KLO',
19: 'Останній рубіж',
20: 'Фінал KLO',
```

2. Update `getCurrentLevel()` method: Change `for (let i = 1; i <= 10; i++)` to `for (let i = 1; i <= 20; i++)` and change `return 10` to `return 20`.

3. Update `scrollToCurrentLevel()`: Change `currentLevelId <= 10` to `currentLevelId <= 20`.

4. Update `create()` method: Change `currentLevelId <= 10` to `currentLevelId <= 20` (in the map pointer section).

5. Update `calculateNodeOffsetX()`: The minNodeX/maxNodeX comments reference x:200 and x:520 — verify these still match the LEVEL_NODES x range (200 and 480). The values 200 and 520 should be updated to 200 and 480 to match actual node x positions. (Note: 520 was the old value, but current nodes use max x:480.)

**Game.ts:**

1. Change `const MAX_LEVELS = 10;` to `const MAX_LEVELS = 20;`

**CardPickOverlay.ts:**

1. Change `const MAX_LEVELS = 10;` to `const MAX_LEVELS = 20;`
  </action>
  <verify>
```bash
grep "MAX_LEVELS" src/scenes/Game.ts src/scenes/CardPickOverlay.ts  # Both should show 20
grep "i <= 20" src/scenes/LevelSelect.ts                           # getCurrentLevel loop
grep "'Фінал KLO'" src/scenes/LevelSelect.ts                      # Level 20 name exists
```
Run `npx tsc --noEmit` to verify no TypeScript errors.
  </verify>
  <done>
LevelSelect displays 20 level nodes with names and Kyiv landmarks, Game scene treats L20 as last level, CardPickOverlay navigates correctly through all 20 levels. All hardcoded "10" references updated to "20".
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. MAP_CONFIG.LEVEL_NODES has exactly 20 entries
3. LEVEL_NAMES has entries for levels 1-20
4. Boot.ts loads level_001 through level_020
5. MAX_LEVELS = 20 in both Game.ts and CardPickOverlay.ts
6. LevelSelect getCurrentLevel() iterates through 20 levels
7. Map pointer works for levels 1-20
</verification>

<success_criteria>
- All 20 levels are accessible from the level select map
- Level nodes display correctly on the scrollable Kyiv map
- Game correctly identifies L20 as the final level
- Card pick navigation works for levels beyond 10
- No TypeScript compilation errors
</success_criteria>

<output>
After completion, create `.planning/phases/25-new-levels/25-02-SUMMARY.md`
</output>
