---
phase: 15-card-acquisition-flow
plan: 04
type: execute
wave: 1
depends_on: []
files_modified: [src/scenes/Game.ts]
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Bonus hint text 'Бонус: обери картку!' does not overlap with lives display on win overlay"
    - "Card name and rarity label on picked/revealed cards have clear visual spacing with no overlap"
  artifacts:
    - path: "src/scenes/Game.ts"
      provides: "Fixed coordinate values for bonus hint and rarity label"
      contains: "cssToGame(100).*Бонус"
  key_links:
    - from: "bonus hint Y position"
      to: "lives display Y position"
      via: "adequate CSS pixel gap (15+ px)"
      pattern: "cssToGame\\(100\\)"
    - from: "rarity label Y offset"
      to: "card name Y offset"
      via: "adequate CSS pixel gap (22+ px)"
      pattern: "cssToGame\\(120\\)"
---

<objective>
Fix two remaining text overlap issues from UAT in the Game.ts win overlay and card pick UI.

Purpose: Close the last 2 cosmetic gaps from Phase 15 UAT testing -- bonus hint overlaps lives display, and card name overlaps rarity label on card reveal.
Output: Updated src/scenes/Game.ts with corrected Y coordinates.
</objective>

<execution_context>
@/Users/vasiliyhrebenuyk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vasiliyhrebenuyk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/15-card-acquisition-flow/15-03-SUMMARY.md
@src/scenes/Game.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix bonus hint and rarity label Y coordinates in Game.ts</name>
  <files>src/scenes/Game.ts</files>
  <action>
Two coordinate changes in src/scenes/Game.ts:

**Fix 1 — Bonus hint overlaps lives display (line ~374):**
The bonus hint "Бонус: обери картку!" is at cssToGame(75). The lives display is at starY + cssToGame(25), which resolves to cssToGame(70) for 1-2 stars or cssToGame(85) for 3 stars. Both use overlaySubtitleSize (~16px CSS) so they overlap.

Change the bonus hint Y from `cssToGame(75)` to `cssToGame(100)`.

This gives:
- 30px clearance from lives when 1-2 stars (lives at 70, hint at 100)
- 15px clearance from lives when 3 stars (lives at 85, hint at 100)
- Both well above the "Далі" button at panelH - cssToGame(80)

Find this line:
```typescript
const bonusHint = this.add.text(panelW / 2, cssToGame(75), 'Бонус: обери картку!', {
```
Change `cssToGame(75)` to `cssToGame(100)`.

**Fix 2 — Card name/rarity label overlap on card pick (line ~638):**
The rarity label is positioned at `card.y + cssToGame(98)` in panel coordinates. The card name inside the container is at `cardH/2 + cssToGame(12)` which in panel coords is approximately `card.y + cardH/2 + cssToGame(12)`. With card heights around 160-170px game coords, the name ends up very close to the rarity at 98. Previous fix (commit 499e91a) changed CardPickOverlay.ts but that scene is NOT used — the actual card pick runs in Game.ts showCardPickInOverlay/handleCardPick.

Change the rarity label Y offset from `cssToGame(98)` to `cssToGame(120)`.

Find this line in handleCardPick():
```typescript
const label = this.add.text(card.x, card.y + cssToGame(98), rarityLabels[cardDef.rarity], {
```
Change `cssToGame(98)` to `cssToGame(120)`.

This gives 22px more clearance between the card name and rarity label — sufficient for both 12px name font and 11px rarity font with comfortable visual gap.

**No other changes needed.** Both fixes are single-number coordinate adjustments.
  </action>
  <verify>
Run TypeScript compilation: `npx tsc --noEmit`
Run production build: `npx vite build`
Both must pass with no new errors.
  </verify>
  <done>
Bonus hint at cssToGame(100) with 15-30px clearance from lives display. Rarity label at cssToGame(120) with 22+ px clearance from card name. Build passes.
  </done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes
- `npx vite build` succeeds
- In Game.ts: bonus hint Y uses cssToGame(100), not cssToGame(75)
- In Game.ts: rarity label Y uses cssToGame(120), not cssToGame(98)
</verification>

<success_criteria>
1. Bonus hint "Бонус: обери картку!" positioned at cssToGame(100) — no overlap with lives display at any star count
2. Rarity label positioned at card.y + cssToGame(120) — clear spacing from card name text
3. TypeScript and Vite build pass without errors
</success_criteria>

<output>
After completion, create `.planning/phases/15-card-acquisition-flow/15-04-SUMMARY.md`
</output>
