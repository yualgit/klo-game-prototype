---
phase: 05-assets-polish
plan: 03
type: execute
wave: 3
depends_on: ["05-01", "05-02"]
files_modified:
  - src/scenes/Menu.ts
  - src/scenes/LevelSelect.ts
  - src/scenes/Game.ts
  - src/scenes/Boot.ts
autonomous: false

must_haves:
  truths:
    - "Menu scene has animated title with subtle glow and floating tile decorations"
    - "LevelSelect shows a mini road map path with 5 checkpoint buttons"
    - "Game board has polished background (gradient or themed)"
    - "Win overlay has animated star reveal and score counter"
    - "Lose overlay is styled with appropriate visual treatment"
    - "Scene transitions use slide/fade effects (not instant cuts)"
    - "GUI buttons use orange/yellow PNG sprites from assets/gui/"
    - "Demo feels premium casual with KLO yellow/black branding throughout"
  artifacts:
    - path: "src/scenes/Menu.ts"
      provides: "Animated title screen with floating tiles and bounce Play button"
      contains: "this.tweens"
    - path: "src/scenes/LevelSelect.ts"
      provides: "Mini road map with path line and checkpoint buttons"
      contains: "mapPointer"
    - path: "src/scenes/Game.ts"
      provides: "Polished win/lose overlays, game board background"
      contains: "starReveal"
  key_links:
    - from: "src/scenes/Menu.ts"
      to: "Boot preloaded textures"
      via: "GUI texture keys for Play button"
      pattern: "gui_button"
    - from: "src/scenes/LevelSelect.ts"
      to: "Boot preloaded textures"
      via: "GUI textures for level buttons, lock, map pointer"
      pattern: "gui_"
    - from: "src/scenes/Game.ts"
      to: "Boot preloaded textures"
      via: "GUI textures for overlay buttons, crown/stars"
      pattern: "gui_"
---

<objective>
Polish all scenes to client-presentation quality with animated menus, road map level select, styled overlays, scene transitions, and GUI sprite buttons.

Purpose: This is the final visual layer that turns a working game into a premium demo. The user explicitly requested animated title screen, mini road map, star animations, confetti win, slide transitions, and organic micro-interactions. This plan delivers the "wow" that sells the demo.
Output: All 4 scenes polished with animations, transitions, GUI sprites, and KLO branding. Demo-ready quality.
</objective>

<execution_context>
@/Users/vasiliyhrebenuyk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vasiliyhrebenuyk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-assets-polish/05-01-SUMMARY.md
@.planning/phases/05-assets-polish/05-02-SUMMARY.md
@src/scenes/Menu.ts
@src/scenes/LevelSelect.ts
@src/scenes/Game.ts
@src/scenes/Boot.ts
@src/game/constants.ts
@src/utils/constants.ts
@STYLE_GUIDE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Polish Menu scene (animated title, floating tiles, bounce Play) and LevelSelect scene (road map with path)</name>
  <files>
    src/scenes/Menu.ts
    src/scenes/LevelSelect.ts
    src/scenes/Boot.ts
  </files>
  <action>
**A. Menu Scene — Animated Title Screen**

Rewrite Menu.ts create() to be a premium animated title screen:

1. **Background**: Soft gradient from light (#F9F9F9) at top to slightly warm (#FFF5E0) at bottom. Use a Graphics object with fillGradientStyle or two overlapping rectangles.

2. **Floating tile decorations**: Create 4-6 tile Images (from loaded tile textures) that float/bob gently in the background. Place them around the edges/corners. Each has a continuous tween:
```typescript
// For each floating tile:
const floater = this.add.image(x, y, textureKey);
floater.setDisplaySize(48, 48);
floater.setAlpha(0.3);
this.tweens.add({
  targets: floater,
  y: y + 15,
  angle: { from: -5, to: 5 },
  duration: 2000 + Math.random() * 1000,
  yoyo: true,
  repeat: -1,
  ease: 'Sine.InOut',
});
```

3. **Title "KLO Match-3"**: Animate in from top with Bounce.Out ease. Add subtle continuous glow/pulse tween on the title:
```typescript
// After title appears:
this.tweens.add({
  targets: title,
  scale: { from: 1, to: 1.02 },
  duration: 1500,
  yoyo: true,
  repeat: -1,
  ease: 'Sine.InOut',
});
```

4. **Play button**: Use `gui_button_orange` Image as background instead of Graphics.fillRoundedRect. Scale Image to button dimensions (200x60). Add continuous subtle bounce tween:
```typescript
this.tweens.add({
  targets: playButton,
  scaleY: { from: 1, to: 1.03 },
  duration: 800,
  yoyo: true,
  repeat: -1,
  ease: 'Sine.InOut',
});
```

5. **Scene transition**: When Play clicked, fade camera out then start LevelSelect:
```typescript
this.cameras.main.fadeOut(300, 0, 0, 0);
this.cameras.main.once('camerafadeoutcomplete', () => {
  this.scene.start('LevelSelect');
});
```

**B. LevelSelect Scene — Mini Road Map**

Rewrite LevelSelect.ts to show a road/path with 5 checkpoint buttons:

1. **Background**: Light warm gradient (same as Menu).

2. **Title "Oberit riven"**: Style with proper font size, slight shadow text effect.

3. **Road path**: Draw a curved/wavy path from bottom-left to top-right using Graphics lines. The path connects 5 checkpoint positions arranged in a winding road pattern:
```typescript
// 5 checkpoint positions along a winding path
const checkpoints = [
  { x: width * 0.2, y: height * 0.78 },
  { x: width * 0.5, y: height * 0.65 },
  { x: width * 0.3, y: height * 0.48 },
  { x: width * 0.6, y: height * 0.35 },
  { x: width * 0.5, y: height * 0.2 },
];
```
Draw the path with a thick line (lineStyle 8-10px, light gray #dddddd), then draw a thinner colored line on top for "completed" progress.

4. **Level checkpoint buttons**: Replace the row of squares with circular buttons at checkpoint positions:
- Use `gui_button_orange` (scaled to circle-like 70x70) for unlocked, or a gray tinted version for locked.
- Level number text centered on button.
- Stars below each button (keep star/empty-star text or use small gold circles).
- For locked levels, overlay `gui_gold_lock` icon.
- For completed levels with 3 stars, add `gui_crown1` icon above.

5. **Map pointer**: Show `gui_map_pointer` image at the current highest unlocked level, with a gentle bobbing tween.

6. **Back button**: Style with `gui_button_yellow` image instead of Graphics.

7. **Scene entrance**: Fade camera in from black on create:
```typescript
this.cameras.main.fadeIn(300, 0, 0, 0);
```

8. **Level start transition**: When level button clicked, fade out to black:
```typescript
this.cameras.main.fadeOut(300, 0, 0, 0);
this.cameras.main.once('camerafadeoutcomplete', () => {
  this.scene.start('Game', { levelId });
});
```

**C. Boot Scene — Add fade transition**

In Boot.ts create(), add fade transition to Menu:
```typescript
this.cameras.main.fadeOut(200, 0, 0, 0);
this.cameras.main.once('camerafadeoutcomplete', () => {
  this.scene.start('Menu');
});
```
  </action>
  <verify>
Run `npx tsc --noEmit` — no errors. Run `npm run dev`:
1. Boot loads, fades to Menu
2. Menu shows animated title with floating tiles in background, glow pulse on title, bouncing Play button with orange GUI sprite background
3. Click Play — camera fades out, LevelSelect fades in
4. LevelSelect shows winding road path with 5 circular checkpoint buttons
5. Map pointer bobs at current level
6. Locked levels show gold lock overlay
7. Click a level — fades to Game scene
  </verify>
  <done>
Menu has animated title screen with floating tiles, subtle title glow, GUI-sprite Play button with bounce. LevelSelect shows mini road map with winding path, circular checkpoint buttons, map pointer, gold lock overlays, and crown decorations. All scene transitions use camera fade effects. Back buttons use GUI sprite images.
  </done>
</task>

<task type="auto">
  <name>Task 2: Polish Game scene — board background and GUI sprite buttons</name>
  <files>
    src/scenes/Game.ts
  </files>
  <action>
Enhance Game.ts with polished backgrounds and GUI sprite buttons. This task focuses on the board background, button upgrades, and scene transition. Win/lose overlay animation upgrades are in Task 3.

**1. Game board background upgrade:**

Replace `drawGridBackground()` with a more polished version:
- Soft gradient background for the full scene (light warm tones)
- Board area: rounded rectangle with subtle shadow/border effect. Use a slightly darker fill (#EEEEEE) with rounded corners and a faint stroke:
```typescript
// Scene background gradient
const bg = this.add.graphics();
bg.fillGradientStyle(0xFFFBF0, 0xFFFBF0, 0xFFF0D0, 0xFFF0D0, 1);
bg.fillRect(0, 0, width, height);

// Board background with shadow
const shadow = this.add.graphics();
shadow.fillStyle(0x000000, 0.08);
shadow.fillRoundedRect(gridX - 12, gridY - 12, gridW + 24, gridH + 24, 16);

const board = this.add.graphics();
board.fillStyle(0xFFFFFF, 0.6);
board.fillRoundedRect(gridX - 8, gridY - 8, gridW + 16, gridH + 16, 14);
```

**2. `createOverlayButton` upgrade:**

Modify to accept an optional texture key and use Image instead of Graphics for button background:
```typescript
// If texture available, use Image; else fall back to Graphics
const bgImage = this.add.image(0, 0, secondary ? 'gui_button_yellow' : 'gui_button_orange');
bgImage.setDisplaySize(buttonWidth, buttonHeight);
```

**3. Back button upgrade:**
Use `gui_button_yellow` Image instead of Graphics for the back button.

**4. Scene entrance:**
Add `this.cameras.main.fadeIn(300)` at start of create().

**5. HUD styling upgrade:**

Improve `createHUD()` and `updateHUDText()`:
- Use a proper styled bar at top with KLO branding
- Level number in a badge/circle
- Moves counter with icon/emphasis
- Goals with mini tile icons (use loaded tile textures scaled very small ~20x20)
  </action>
  <verify>
Run `npx tsc --noEmit` — no errors. Run `npm run dev`, play through:
1. Game scene fades in with warm gradient background
2. Board area has polished white/shadow background
3. HUD shows level info with styled bar
4. All buttons use orange/yellow PNG sprite backgrounds
5. Back button uses GUI sprite
  </verify>
  <done>
Game scene has warm gradient background with polished board area. All buttons use GUI PNG sprite backgrounds (orange primary, yellow secondary). HUD is styled with KLO branding. Scene entrance uses camera fade.
  </done>
</task>

<task type="auto">
  <name>Task 3: Polish win/lose overlays with animated star reveal and coupon styling</name>
  <files>
    src/scenes/Game.ts
  </files>
  <action>
Enhance win and lose overlays in Game.ts with premium animation and styling. This task modifies only the overlay methods, not the board background or HUD (handled in Task 2).

**1. Win overlay upgrade — animated star reveal + score counter:**

Rewrite `showWinOverlay()`:
- Keep dark backdrop with fade-in tween
- Panel slides in from top with Bounce.Out ease (not instant)
- **Stars animate in sequence**: Each star (1-3) scales from 0 to 1 with a 300ms delay between them, using Elastic.Out ease. Empty stars appear as gray outlines.
- **Score counter**: Tween a counter from 0 to final score (if score exists) or moves-remaining display
- **Confetti**: Trigger `this.vfxManager.confettiBurst()` when stars appear
- Use `gui_crown1` icon above stars for 3-star completion
- Buttons use `gui_button_orange` image for primary (Next/Continue), `gui_button_yellow` for secondary (Levels)
- Coupon mock for L5: Style with KLO yellow card, gold border, prominent text

```typescript
// Panel slide-in:
const panel = this.add.container(width / 2, -200); // Start above screen
this.tweens.add({
  targets: panel,
  y: height / 2,
  duration: 500,
  ease: 'Bounce.Out',
});

// Star reveal sequence:
for (let i = 0; i < 3; i++) {
  const star = this.add.text(starX + i * 50, starY, i < earnedStars ? '\u2605' : '\u2606', starStyle);
  star.setScale(0);
  this.tweens.add({
    targets: star,
    scale: 1,
    delay: 300 + i * 300,
    duration: 400,
    ease: 'Elastic.Out',
  });
}
```

**2. Lose overlay upgrade:**

Rewrite `showLoseOverlay()`:
- Panel slides in with Back.Out ease
- Title styled with appropriate somber tone (but not depressing — motivational)
- Buttons use GUI sprite backgrounds
- Add a brief camera tint/shake before overlay appears
  </action>
  <verify>
Run `npx tsc --noEmit` — no errors. Run `npm run dev`, play through:
1. Win a level — panel slides in from top, stars animate in one-by-one with elastic bounce, confetti bursts
2. Level 5 win — coupon mock displays in premium style
3. Lose a level — panel slides in, retry/menu buttons styled with GUI sprites
4. All overlay buttons use orange/yellow PNG sprite backgrounds
  </verify>
  <done>
Win overlay panel slides in with bounce, stars animate sequentially with Elastic.Out, confetti triggers on win. Crown icon appears for 3-star completion. Lose overlay slides in with styled treatment. All overlay buttons use GUI PNG sprite backgrounds. Coupon mock for L5 styled with KLO branding.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 4: Visual quality verification</name>
  <what-built>
Complete visual overhaul of KLO Match-3 demo:
- PNG tile sprites replacing colored rectangles
- Obstacle sprite progression (ice, grass/dirt) and bubble.png for crate
- Animated Menu with floating tiles and glow
- Mini road map LevelSelect with path and checkpoints
- Particle VFX on match clearing and booster activation
- Sound effects on all gameplay events
- Win overlay with animated star reveal and confetti
- GUI sprite buttons throughout
- Scene transitions with fade effects
- KLO yellow/black branding throughout
  </what-built>
  <how-to-verify>
1. Run `npm run dev` and open in browser
2. **Menu**: Verify animated title with floating tiles in background, orange Play button with subtle bounce
3. **Level Select**: Verify road map path with circular checkpoint buttons, map pointer at current level, gold locks on locked levels
4. **Gameplay** (Level 1):
   - Tiles are PNG images (coffee cup, fuel can, wheel, light), NOT colored rectangles
   - Swap two tiles — observe bounce animation and swap sound
   - Match 3 — observe particle pop at cleared tiles + match sound
   - Let cascade chain — effects should escalate
5. **Boosters** (Level 3+ with obstacles): If a booster activates, verify dramatic VFX (line sweep / explosion / color wave) with sound
6. **Obstacles**: Ice and grass should show actual sprite images with damage progression
7. **Win a level**: Panel slides in, stars animate one-by-one, confetti bursts, win sound plays
8. **Lose a level**: Panel slides in, retry/menu buttons styled, lose sound plays
9. **Scene transitions**: All transitions use fade effects (no instant cuts)
10. **Overall feel**: Does it feel "premium casual" — glossy, clean, polished? Would it impress a client?
11. **Mobile**: Open on phone/tablet — FPS stays smooth, no obvious performance issues
  </how-to-verify>
  <resume-signal>Type "approved" or describe specific issues to fix</resume-signal>
</task>

</tasks>

<verification>
1. All 4 tile types display PNG sprites (fuel_can, coffee, wheel, light)
2. Ice obstacles show 3-stage damage progression sprites
3. Dirt/grass obstacles show 3-stage damage progression sprites
4. Crate obstacles display bubble.png (1-hit blocker)
5. Menu has animated title, floating tiles, bounce Play button
6. LevelSelect shows road map with 5 checkpoints
7. Match clearing shows particle VFX + sound
8. Booster activation shows dramatic VFX + sound
9. Win overlay has animated star reveal + confetti
10. All buttons use GUI PNG sprite backgrounds
11. Scene transitions use camera fade
12. KLO yellow/black branding consistent throughout
13. 60fps on desktop, 30+ fps on mobile
</verification>

<success_criteria>
- Demo looks and feels like a premium casual match-3 game
- KLO branding (yellow/black) consistent throughout all screens
- Booster VFX is the "wow factor" moment
- Win celebration feels satisfying (stars + confetti + sound)
- All scene transitions are smooth (no instant cuts)
- Sound effects play at appropriate moments
- Client would be impressed by the demo quality
</success_criteria>

<output>
After completion, create `.planning/phases/05-assets-polish/05-03-SUMMARY.md`
</output>
