---
phase: 11-art-asset-quality-upgrade
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/game/types.ts
  - src/game/constants.ts
  - src/game/Match3Engine.ts
  - src/scenes/Boot.ts
  - data/levels/level_001.json
  - data/levels/level_002.json
  - data/levels/level_003.json
  - data/levels/level_004.json
  - data/levels/level_005.json
  - data/levels/level_006.json
  - data/levels/level_007.json
  - data/levels/level_008.json
  - data/levels/level_009.json
  - data/levels/level_010.json
  - public/data/levels/level_001.json
  - public/data/levels/level_002.json
  - public/data/levels/level_003.json
  - public/data/levels/level_004.json
  - public/data/levels/level_005.json
autonomous: true

must_haves:
  truths:
    - "TileType union contains exactly burger, hotdog, oil, water, snack, soda, empty — no fuel, coffee, road, or light"
    - "SpawnRules interface has fields for all 6 new tile types (burger, hotdog, oil, water, snack, soda)"
    - "Match3Engine generates and spawns tiles using the 6 new types with weighted random selection"
    - "Boot scene preloads all 6 new tile PNGs, 4 booster PNGs, and 1 block PNG — no old tile assets loaded"
    - "All 10 level JSONs use new tile types in spawn_rules and goals — no fuel/coffee/road references remain"
    - "Levels with cell_map have inactive_cell_style field (block or transparent)"
  artifacts:
    - path: "src/game/types.ts"
      provides: "Updated TileType union and SpawnRules interface"
      contains: "burger.*hotdog.*oil.*water.*snack.*soda"
    - path: "src/game/constants.ts"
      provides: "Updated TILE_TYPES, TEXTURE_KEYS, TILE_COLORS"
      contains: "tile_burger"
    - path: "src/game/Match3Engine.ts"
      provides: "Updated getRandomTileType and estimateSpawnRules for 6 types"
      contains: "burger.*hotdog.*oil.*water.*snack.*soda"
    - path: "src/scenes/Boot.ts"
      provides: "Asset loading for new tiles, boosters, block"
      contains: "booster_bomb"
  key_links:
    - from: "src/game/constants.ts"
      to: "src/game/types.ts"
      via: "TEXTURE_KEYS uses TileType as key"
      pattern: "Record<TileType, string>"
    - from: "src/scenes/Boot.ts"
      to: "src/game/constants.ts"
      via: "Preloads textures matching TEXTURE_KEYS values"
      pattern: "load.image.*tile_burger"
    - from: "src/game/Match3Engine.ts"
      to: "src/game/types.ts"
      via: "getRandomTileType returns TileType, SpawnRules used as param"
      pattern: "getRandomTileType.*SpawnRules"
---

<objective>
Replace the tile type system from 4 old types (fuel/coffee/snack/road) to 6 new KLO-themed types (burger/hotdog/oil/water/snack/soda), remove the deprecated 'light' tile type, update asset loading to include new tiles + boosters + block sprite, and update all level JSON configs with new spawn rules and inactive cell style.

Purpose: Foundation for all visual upgrades — the type system, assets, and level data must be updated before TileSprite rendering and Game scene logic can reference them.
Output: Compilable type system with 6 tile types, Boot scene loading all new assets, and 10 updated level JSONs.
</objective>

<execution_context>
@/Users/vasiliyhrebenuyk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vasiliyhrebenuyk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-art-asset-quality-upgrade/11-CONTEXT.md
@.planning/phases/11-art-asset-quality-upgrade/11-RESEARCH.md

@src/game/types.ts
@src/game/constants.ts
@src/game/Match3Engine.ts
@src/scenes/Boot.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update type system and constants for 6 new tile types</name>
  <files>src/game/types.ts, src/game/constants.ts</files>
  <action>
  **types.ts changes:**
  1. Change TileType from `'fuel' | 'coffee' | 'snack' | 'road' | 'empty'` to `'burger' | 'hotdog' | 'oil' | 'water' | 'snack' | 'soda' | 'empty'`
  2. Update SpawnRules interface: remove fuel/coffee/road fields, add burger/hotdog/oil/water/soda fields (snack stays). All 6 fields should be `number`.
  3. Add `inactive_cell_style?: 'block' | 'transparent'` to the `grid` property in `LevelData` interface.

  **constants.ts changes:**
  1. Update `TILE_TYPES` array: `['burger', 'hotdog', 'oil', 'water', 'snack', 'soda'] as const`
  2. Update `TILE_COLORS` mapping for all 6 types:
     - burger: 0xFFB800 (KLO yellow)
     - hotdog: 0xFF6B35 (orange)
     - oil: 0x1A1A1A (dark/black)
     - water: 0x4A90E2 (blue)
     - snack: 0xF39C12 (golden)
     - soda: 0xE74C3C (red)
  3. Update `TEXTURE_KEYS` mapping:
     - burger: 'tile_burger'
     - hotdog: 'tile_hotdog'
     - oil: 'tile_oil'
     - water: 'tile_water'
     - snack: 'tile_snack'
     - soda: 'tile_soda'
  4. Add `BOOSTER_TEXTURE_KEYS` mapping:
     ```typescript
     export const BOOSTER_TEXTURE_KEYS: Record<string, string> = {
       bomb: 'booster_bomb',
       linear_horizontal: 'booster_klo_horizontal',
       linear_vertical: 'booster_klo_vertical',
       klo_sphere: 'booster_klo_sphere',
     };
     ```
  5. Add block texture key: `export const BLOCK_TEXTURE_KEY = 'block_texture';`
  6. Remove any 'light' references (currently road maps to tile_light — delete that entry).
  </action>
  <verify>Run `npx tsc --noEmit 2>&1 | head -30` to check for type errors. Grep for 'fuel', 'coffee', 'road', 'light' in types.ts and constants.ts — should find none (except comments if any).</verify>
  <done>TileType is exactly 'burger'|'hotdog'|'oil'|'water'|'snack'|'soda'|'empty'. SpawnRules has 6 matching fields. TEXTURE_KEYS, TILE_COLORS, and TILE_TYPES reference all 6 new types. BOOSTER_TEXTURE_KEYS and BLOCK_TEXTURE_KEY constants exported. No 'fuel'/'coffee'/'road'/'light' in type or constant definitions.</done>
</task>

<task type="auto">
  <name>Task 2: Update Match3Engine and Boot scene for new tile types</name>
  <files>src/game/Match3Engine.ts, src/scenes/Boot.ts</files>
  <action>
  **Match3Engine.ts changes:**
  1. Update `getRandomTileType()` method: Replace the cumulative weight logic that references spawnRules.fuel/coffee/snack/road with a generic approach that iterates over SpawnRules fields. The new implementation should:
     ```typescript
     private getRandomTileType(spawnRules: SpawnRules): TileType {
       const entries = Object.entries(spawnRules) as [TileType, number][];
       const totalWeight = entries.reduce((sum, [, w]) => sum + w, 0);
       const random = Math.random() * totalWeight;
       let cumulative = 0;
       for (const [type, weight] of entries) {
         cumulative += weight;
         if (random < cumulative) return type;
       }
       return entries[entries.length - 1][0]; // Fallback to last type
     }
     ```
  2. Update `estimateSpawnRules()` method: Change the counts object from `{ fuel: 0, coffee: 0, snack: 0, road: 0 }` to `{ burger: 0, hotdog: 0, oil: 0, water: 0, snack: 0, soda: 0 }`. Update the fallback equal distribution to `0.167` each (1/6). Update the return to map all 6 types.

  **Boot.ts changes:**
  1. Remove old tile image loads: delete lines loading tile_fuel_can, tile_coffee, tile_wheel, tile_light
  2. Add new tile loads:
     ```typescript
     this.load.image('tile_burger', 'assets/tiles/burger.png');
     this.load.image('tile_hotdog', 'assets/tiles/hotdog.png');
     this.load.image('tile_oil', 'assets/tiles/oil.png');
     this.load.image('tile_water', 'assets/tiles/water.png');
     this.load.image('tile_snack', 'assets/tiles/snack.png');
     this.load.image('tile_soda', 'assets/tiles/soda.png');
     ```
  3. Add booster sprite loads:
     ```typescript
     this.load.image('booster_bomb', 'assets/boosters/bomb.png');
     this.load.image('booster_klo_horizontal', 'assets/boosters/klo_horizontal.png');
     this.load.image('booster_klo_vertical', 'assets/boosters/klo_vertical.png');
     this.load.image('booster_klo_sphere', 'assets/boosters/klo_sphere.png');
     ```
  4. Add block texture load:
     ```typescript
     this.load.image('block_texture', 'assets/blocks/block.png');
     ```
  </action>
  <verify>Run `npx tsc --noEmit 2>&1 | head -30` — no errors in Match3Engine.ts or Boot.ts. Grep for 'fuel_can', 'tile_light', 'tile_wheel' in Boot.ts — should find none.</verify>
  <done>Match3Engine.getRandomTileType uses generic SpawnRules iteration for 6 types. estimateSpawnRules counts all 6 new types. Boot.ts loads 6 new tile PNGs, 4 booster PNGs, 1 block PNG. No old tile assets (fuel_can, coffee, wheel, light) are loaded.</done>
</task>

<task type="auto">
  <name>Task 3: Update all level JSONs with new tile types and inactive cell style</name>
  <files>data/levels/level_001.json through level_010.json, public/data/levels/level_001.json through level_005.json</files>
  <action>
  Update all 10 level JSON files (in both `data/levels/` and `public/data/levels/` where they exist).

  **Spawn rules mapping** (replace old tile type keys with new ones):
  - `fuel` -> `burger` (same weight)
  - `coffee` -> `hotdog` (same weight)
  - `snack` -> `snack` (stays, same weight)
  - `road` -> `oil` (same weight)
  - Add `water` and `soda` by splitting some weight. Strategy: take 0.05 from two largest weights to give water and soda 0.05 each. For levels where all weights are small (e.g., 0.15), use equal 6-way: ~0.167 each.

  Recommended per-level spawn_rules (preserve gameplay feel — dominant tile gets higher weight):

  **Level 1** (tutorial, burger-dominant): burger: 0.30, hotdog: 0.15, oil: 0.15, water: 0.10, snack: 0.15, soda: 0.15
  **Level 2** (burger+hotdog equal): burger: 0.25, hotdog: 0.25, oil: 0.10, water: 0.10, snack: 0.15, soda: 0.15
  **Level 3** (burger-dominant): burger: 0.30, hotdog: 0.15, oil: 0.15, water: 0.10, snack: 0.15, soda: 0.15
  **Level 4** (hotdog-dominant): burger: 0.15, hotdog: 0.30, oil: 0.10, water: 0.10, snack: 0.15, soda: 0.20
  **Level 5** (snack-dominant): burger: 0.15, hotdog: 0.10, oil: 0.15, water: 0.10, snack: 0.30, soda: 0.20
  **Level 6** (burger-dominant, has cell_map): burger: 0.25, hotdog: 0.15, oil: 0.15, water: 0.10, snack: 0.15, soda: 0.20
  **Level 7** (hotdog-dominant, has cell_map): burger: 0.15, hotdog: 0.25, oil: 0.15, water: 0.10, snack: 0.20, soda: 0.15
  **Level 8** (snack-dominant, has cell_map): burger: 0.15, hotdog: 0.10, oil: 0.15, water: 0.15, snack: 0.25, soda: 0.20
  **Level 9** (equal, has cell_map): burger: 0.17, hotdog: 0.17, oil: 0.17, water: 0.16, snack: 0.17, soda: 0.16
  **Level 10** (burger-dominant, has cell_map): burger: 0.25, hotdog: 0.15, oil: 0.15, water: 0.10, snack: 0.15, soda: 0.20

  **Goals mapping** — update `"item"` fields:
  - `"fuel"` -> `"burger"` (levels 1, 3, 6, 10)
  - `"coffee"` -> `"hotdog"` (levels 2, 4, 7)
  - `"snack"` -> `"snack"` (level 5, 8) (no change)

  **Inactive cell style** — for levels with `cell_map` (levels 6-10), add `"inactive_cell_style": "block"` inside the `grid` object. Levels without cell_map don't need this field.

  **Pre-placed tiles** — if any level has pre_placed_tiles with old type names, update those too (fuel->burger, coffee->hotdog, road->oil).

  **IMPORTANT**: Both `data/levels/` and `public/data/levels/` directories contain level files. The `data/levels/` directory has all 10 levels, while `public/data/levels/` has levels 1-5. Update ALL files in BOTH locations. The files in public/data/levels should match their data/levels counterparts for levels 1-5.
  </action>
  <verify>Grep all level JSONs for "fuel", "coffee", "road" — should find zero matches (only burger/hotdog/oil/water/snack/soda). Check levels 6-10 have `inactive_cell_style` in grid. Verify spawn_rules weights sum to ~1.0 in each level.</verify>
  <done>All 10 level JSONs use only new tile type names in spawn_rules and goals. Levels 6-10 have inactive_cell_style: "block" in grid config. No fuel/coffee/road strings remain in any level JSON. Public copies match source for levels 1-5.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` compiles without errors
2. `grep -r '"fuel"\|"coffee"\|"road"\|"light"' data/levels/ public/data/levels/` returns empty
3. `grep -rn "'fuel'\|'coffee'\|'road'\|'light'" src/game/types.ts src/game/constants.ts` returns empty
4. Boot.ts loads exactly: 6 tile images (burger, hotdog, oil, water, snack, soda), 4 booster images, 1 block image
5. All spawn_rules in level JSONs have exactly 6 fields summing to ~1.0
</verification>

<success_criteria>
- Type system compiles with 6 new tile types
- Match3Engine generates tiles from 6-type spawn rules
- Boot scene preloads all required new assets
- All level configs use new type names with valid spawn weights
- Zero references to old tile types (fuel/coffee/road/light) in modified files
</success_criteria>

<output>
After completion, create `.planning/phases/11-art-asset-quality-upgrade/11-01-SUMMARY.md`
</output>
