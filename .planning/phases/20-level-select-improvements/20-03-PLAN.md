---
phase: 20-level-select-improvements
plan: 03
type: execute
wave: 1
depends_on: []
files_modified: [src/scenes/LevelSelect.ts]
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Level nodes and road path appear centered horizontally on mobile screen width"
    - "On a 375px CSS-width device, the road path is visually centered, not shifted right"
  artifacts:
    - path: "src/scenes/LevelSelect.ts"
      provides: "Corrected horizontal centering using MAP_WIDTH center (512) instead of node range center (455)"
      contains: "MAP_CONFIG.MAP_WIDTH"
  key_links:
    - from: "src/scenes/LevelSelect.ts"
      to: "src/game/constants.ts"
      via: "MAP_CONFIG.MAP_WIDTH used for centering offset"
      pattern: "MAP_CONFIG\\.MAP_WIDTH"
---

<objective>
Fix horizontal centering of level nodes on mobile: change the offset calculation to center the MAP_WIDTH (1024) coordinate space on the viewport, not the node x-range (260-650).

Purpose: User reported the road/nodes are shifted right on mobile. Root cause is centering on nodeRangeCenter (455) instead of MAP_WIDTH/2 (512), causing a 57px rightward shift.
Output: Corrected `calculateNodeOffsetX()` in LevelSelect.ts
</objective>

<execution_context>
@/Users/vasiliyhrebenuyk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vasiliyhrebenuyk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/20-level-select-improvements/20-02-SUMMARY.md
@src/scenes/LevelSelect.ts
@src/game/constants.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix horizontal centering to use MAP_WIDTH center</name>
  <files>src/scenes/LevelSelect.ts</files>
  <action>
In `calculateNodeOffsetX()` method (line ~63), change the default offset calculation from:

```typescript
let offsetX = width / 2 - nodeRangeCenter;
```

to:

```typescript
let offsetX = width / 2 - MAP_CONFIG.MAP_WIDTH / 2;
```

This centers the entire 1024px map coordinate space on the viewport (center at x=512), rather than centering just the node x-range (center at x=455). The 57px difference (512-455) is what causes the rightward shift on mobile.

The `nodeRangeCenter` variable and the `minNodeX`/`maxNodeX` constants used to compute it can be removed from the default offset calculation, BUT must be kept for the edge-clamping logic below (lines 66-75 use `minNodeX` and `maxNodeX` to check if nodes clip viewport edges).

Remove the `nodeRangeCenter` variable entirely since it is no longer used.

Keep the rest of the method unchanged:
- Left/right edge clamping (lines 66-75) still uses minNodeX/maxNodeX — keep these
- Narrow viewport fallback scaling (lines 79-87) — keep as-is
- nodeXScale logic — keep as-is

No other files need changes. MAP_CONFIG.MAP_WIDTH is already 1024 in constants.ts.
  </action>
  <verify>
1. `npx tsc --noEmit` compiles without errors
2. `npm run build` succeeds
3. Manual check: In the built code, confirm `calculateNodeOffsetX` references `MAP_CONFIG.MAP_WIDTH` and does NOT reference `nodeRangeCenter`
  </verify>
  <done>
`calculateNodeOffsetX()` computes default offset as `width/2 - MAP_CONFIG.MAP_WIDTH/2` (not `width/2 - nodeRangeCenter`). On a 375px CSS-width mobile device (750px game width), the offset will be `750/2 - 512 = -137` instead of the old `750/2 - 455 = -80`, shifting nodes 57px leftward to proper center.
  </done>
</task>

</tasks>

<verification>
- TypeScript compiles: `npx tsc --noEmit`
- Build succeeds: `npm run build`
- In LevelSelect.ts, `calculateNodeOffsetX()` uses `MAP_CONFIG.MAP_WIDTH / 2` for centering, not a hardcoded nodeRangeCenter value
</verification>

<success_criteria>
- The default horizontal offset centers the MAP_WIDTH coordinate system (center=512) on the viewport, not the node range (center=455)
- Edge clamping and narrow-viewport scaling still function correctly
- No TypeScript or build errors
</success_criteria>

<output>
After completion, create `.planning/phases/20-level-select-improvements/20-03-SUMMARY.md`
</output>
